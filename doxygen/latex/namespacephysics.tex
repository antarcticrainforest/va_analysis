\hypertarget{namespacephysics}{}\section{physics Module Reference}
\label{namespacephysics}\index{physics@{physics}}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{namespacephysics_a3f1959e7b3ff1a8d052f1e0441b1c379}{s\+\_\+r\+\_\+to\+\_\+t\+\_\+z} (P, PS, ZS, S, R, T, Z)
\item 
subroutine \hyperlink{namespacephysics_aebc42cd426e3ef8e85696bb1c7da18c3}{t\+\_\+r\+\_\+to\+\_\+s\+\_\+z} (P, PS, ZS, T, R, S, Z)
\item 
subroutine \hyperlink{namespacephysics_adc35216d512f6586071a79fba286a39c}{diverg} (U\+N\+I\+TH, V\+AR, U, V, D\+I\+VU, D\+I\+VV, D\+I\+V1)
\item 
subroutine \hyperlink{namespacephysics_a56a179b5bd2c13a2201b2367037a42cf}{fcorlx} (U\+N\+I\+TH, N\+S\+TU, F, V, F\+C\+X1)
\item 
subroutine \hyperlink{namespacephysics_a1f64bd544ea55c7fbbf5330725fc0896}{fcorly} (U\+N\+I\+TH, N\+S\+TU, F, U, F\+C\+Y1)
\item 
subroutine \hyperlink{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{fpgd} (U\+N\+I\+TH, Z, D\+Z\+DX, F\+P1)
\item 
subroutine \hyperlink{namespacephysics_a0ca41ce81224f2d7b292dc474c080c60}{height} (NP, KS, KT, P, T, R, Z)
\item 
subroutine \hyperlink{namespacephysics_a16ab28545ccd5528dd72f50208761dbe}{calht2} (PS, ZS, N, P, TC, R, HT, D\+EW)
\item 
subroutine \hyperlink{namespacephysics_a9197b79c7b8e6dfce5ecca360c320610}{calc\+\_\+state2} (P, T, TD, E, Z, R, RH, H, H\+D\+RY, S)
\end{DoxyCompactItemize}


\subsection{Function/\+Subroutine Documentation}
\index{physics@{physics}!calc\+\_\+state2@{calc\+\_\+state2}}
\index{calc\+\_\+state2@{calc\+\_\+state2}!physics@{physics}}
\subsubsection[{\texorpdfstring{calc\+\_\+state2(\+P, T, T\+D, E, Z, R, R\+H, H, H\+D\+R\+Y, S)}{calc_state2(P, T, TD, E, Z, R, RH, H, HDRY, S)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::calc\+\_\+state2 (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), intent(in)}]{P, }
\item[{real (kind=rk8), intent(in)}]{T, }
\item[{real (kind=rk8), intent(in)}]{TD, }
\item[{real (kind=rk8), intent(in)}]{E, }
\item[{real (kind=rk8), intent(in)}]{Z, }
\item[{real (kind=rk8), intent(out)}]{R, }
\item[{real (kind=rk8), intent(in)}]{RH, }
\item[{real (kind=rk8), intent(out)}]{H, }
\item[{real (kind=rk8), intent(out)}]{H\+D\+RY, }
\item[{real (kind=rk8), intent(out)}]{S}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_a9197b79c7b8e6dfce5ecca360c320610}{}\label{namespacephysics_a9197b79c7b8e6dfce5ecca360c320610}


Definition at line 368 of file physics.\+f90.


\begin{DoxyCode}
368 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
369 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
370 
371 \textcolor{keywordtype}{IMPLICIT NONE}
372 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}     :: p    \textcolor{comment}{! Pressure (Pa) - check units.}
373 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}     :: t    \textcolor{comment}{! Temperature (K).}
374 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}     :: td   \textcolor{comment}{! Dew point temperature (K).}
375 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}     :: e    \textcolor{comment}{! Vapour pressure (Pa - check units.}
376 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}     :: z    \textcolor{comment}{! Geopotential height (m) - check units.}
377 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(OUT)}    :: r    \textcolor{comment}{! Mixing ratio.}
378 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}     :: rh   \textcolor{comment}{! Relative humidity (decimal fraction between 0 and 1). }
379 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(OUT)}    :: h    \textcolor{comment}{!}
380 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(OUT)}    :: hdry \textcolor{comment}{!}
381 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(OUT)}    :: s    \textcolor{comment}{!}
382 
383 \textcolor{comment}{!}
384 \textcolor{comment}{! Local variables.}
385 \textcolor{comment}{!}
386 \textcolor{keywordtype}{REAL (KIND=RK8)}                 :: ep, es, rs, lv1
387 
388 ep      = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}/\hyperlink{namespaceconstants_a7ef8fc37397fbfbefd3c22883378dcc5}{rw}
389 es      = 1.003*exp(53.67957 - 6743.769/t - 4.8451*log(t))  \textcolor{comment}{! An empirical formula for the saturation
       vapour pressure.}
390 rs      = ep*es/(p-es)
391 r       = rs*rh
392 lv1     = \hyperlink{namespaceconstants_afb3befdfd57058ee9d073b832134a601}{lv0} + (\hyperlink{namespaceconstants_afc5ea9cd5f9cf3a42e750ba5ab73c967}{cpv}-\hyperlink{namespaceconstants_a4f2911e99beba65b9371b9a80d7c08d0}{cl})*(t-\hyperlink{namespaceconstants_a753fbbdd5d5b4af00d6819cb78ba99a1}{t0})
393 h       = (\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd} + r*\hyperlink{namespaceconstants_a4f2911e99beba65b9371b9a80d7c08d0}{cl})*t + lv1*r + (1.0 + r)*\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*z
394 hdry    = \hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}*t + \hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*z
395 s       = \hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}*log(t) - \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}*log(p) + \hyperlink{namespaceconstants_afb3befdfd57058ee9d073b832134a601}{lv0}*r/t - r*\hyperlink{namespaceconstants_a7ef8fc37397fbfbefd3c22883378dcc5}{rw}*log(rh)
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=269pt]{namespacephysics_a9197b79c7b8e6dfce5ecca360c320610_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!calht2@{calht2}}
\index{calht2@{calht2}!physics@{physics}}
\subsubsection[{\texorpdfstring{calht2(\+P\+S, Z\+S, N, P, T\+C, R, H\+T, D\+E\+W)}{calht2(PS, ZS, N, P, TC, R, HT, DEW)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::calht2 (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), intent(in)}]{PS, }
\item[{real (kind=rk8), intent(in)}]{ZS, }
\item[{integer (kind=ik4), intent(in)}]{N, }
\item[{real (kind=rk8), dimension(n), intent(in)}]{P, }
\item[{real (kind=rk8), dimension(n), intent(in)}]{TC, }
\item[{real (kind=rk8), dimension(n), intent(inout)}]{R, }
\item[{real (kind=rk8), dimension(n), intent(out)}]{HT, }
\item[{real (kind=rk8), dimension(n), intent(out)}]{D\+EW}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_a16ab28545ccd5528dd72f50208761dbe}{}\label{namespacephysics_a16ab28545ccd5528dd72f50208761dbe}


Definition at line 284 of file physics.\+f90.


\begin{DoxyCode}
284 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
285 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
286 
287 \textcolor{keywordtype}{IMPLICIT NONE}
288 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                       :: ps     \textcolor{comment}{! Surface pressure (units).}
289 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                       :: zs     \textcolor{comment}{! Surface geopotential (units).}
290 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                    :: n      \textcolor{comment}{! Number of vertical levels.}
291 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(IN)}         :: p      \textcolor{comment}{! Pressures (units).}
292 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(IN)}         :: tc     \textcolor{comment}{! Temperatures (Celsius).}
293 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(INOUT)}      :: r      \textcolor{comment}{! Relative humidity (%).}
294 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(OUT)}        :: ht     \textcolor{comment}{! Geopotential height (units).}
295 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(OUT)}        :: dew    \textcolor{comment}{! Dew-point temperature? (units).}
296 
297 \textcolor{comment}{!}
298 \textcolor{comment}{! Local variables.}
299 \textcolor{comment}{!}
300 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}                     :: rh     \textcolor{comment}{! Relative humidity converted to 0-1 range.}
301 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}                     :: t      \textcolor{comment}{! Temperature in Kelvin.}
302 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}                     :: es     \textcolor{comment}{! Saturation vapour pressure.}
303 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}                     :: rs     \textcolor{comment}{! Saturated mixing ratio.}
304 \textcolor{keywordtype}{REAL (KIND=RK8)}                                   :: ep     \textcolor{comment}{! = RD/RW}
305 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                :: ks     \textcolor{comment}{! Index of first vertical level at or above the
       surface.}
306 \textcolor{keywordtype}{REAL (KIND=RK8)}                                   :: r1, dz
307 
308 \textcolor{comment}{!}
309 \textcolor{comment}{! Convert the relative humidity to the 0-1 range. Any humidities less than 0 or greater than 1 are set to
       1. Not sure of the}
310 \textcolor{comment}{! reasoning behind making RH<0 go to 1 ... maybe missing data is better substituted with 1 RH than some
       other value?}
311 \textcolor{comment}{!}
312 rh  = r/100.0               
313 \textcolor{keywordflow}{WHERE} ((rh .LT. 0.0) .OR. (rh .GT. 1.0)) rh = 1.0
314 
315 t   = tc + \hyperlink{namespaceconstants_a753fbbdd5d5b4af00d6819cb78ba99a1}{t0}               \textcolor{comment}{! Convert temperatures in Celsius to Kelvin.}
316 
317 \textcolor{comment}{!}
318 \textcolor{comment}{! Calculate the saturation vapour pressure using a modified form of the Clausius-Clayperon equation. I
       believe this equation might}
319 \textcolor{comment}{! be in Emanuel (1994): "Atmospheric Convection" (maybe).}
320 \textcolor{comment}{!}
321 es  = 1.003*exp(53.67957 - 6743.769/t - 4.8451*log(t))
322 ep  = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}/\hyperlink{namespaceconstants_a7ef8fc37397fbfbefd3c22883378dcc5}{rw}                 \textcolor{comment}{! This will be used several times in this subroutine (so save resources by
       only calculating it once).}
323 
324 rs  = ep*es/(p-es)          \textcolor{comment}{! Calculate the saturated mixing ratio.}
325 
326 \textcolor{comment}{!}
327 \textcolor{comment}{! Overwrite the input relative humidities (R, in %) with mixing ratio.}
328 \textcolor{comment}{!}
329 r   = rs*rh
330 
331 \textcolor{comment}{!}
332 \textcolor{comment}{! Locate the first level, at or above the surface (which has pressure PS). Default to 1 if we can't find
       the surface.}
333 \textcolor{comment}{!}
334 ks  = max(transfer(maxloc(p, mask = p .LE. ps), 0),1)
335 
336 \textcolor{comment}{!}
337 \textcolor{comment}{! Work out the geopotential height of the first level. I added a little bit of code to deal with the
       situation where KS=1. The IDL}
338 \textcolor{comment}{! code did not seem to deal with this, assuming that there was always at least one pressure level "below
       the surface", and did a}
339 \textcolor{comment}{! simple interpolation. If there is no level below the surface, can't do interpolation.}
340 \textcolor{comment}{!}
341 r1      = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}*0.5*((1+r(max(1,ks-1))/ep)/(1+r(max(1,ks-1))) + (1+r(ks)/ep)/(1+r(ks)))
342 dz      = r1/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*0.5*(t(max(1,ks-1))/p(max(1,ks-1)) + t(ks)/p(ks)) * (ps/p(ks))
343 ht(ks)  = zs + dz
344 
345 \textcolor{comment}{!}
346 \textcolor{comment}{! Work out the geopotential height of all the vertical levels above the surface.}
347 \textcolor{comment}{!}
348 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a0ca41ce81224f2d7b292dc474c080c60}{height}(n, ks, n, p, t, r, ht)
349 
350 \textcolor{comment}{!}
351 \textcolor{comment}{! Assign the surface geopotential height to all levels below the surface.}
352 \textcolor{comment}{!}
353 ht(1:max(1,ks-1))  = zs
354 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{namespacephysics_a16ab28545ccd5528dd72f50208761dbe_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=245pt]{namespacephysics_a16ab28545ccd5528dd72f50208761dbe_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!diverg@{diverg}}
\index{diverg@{diverg}!physics@{physics}}
\subsubsection[{\texorpdfstring{diverg(\+U\+N\+I\+T\+H, V\+A\+R, U, V, D\+I\+V\+U, D\+I\+V\+V, D\+I\+V1)}{diverg(UNITH, VAR, U, V, DIVU, DIVV, DIV1)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::diverg (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{U\+N\+I\+TH, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{V\+AR, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{U, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{V, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{D\+I\+VU, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{D\+I\+VV, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{D\+I\+V1}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_adc35216d512f6586071a79fba286a39c}{}\label{namespacephysics_adc35216d512f6586071a79fba286a39c}


Definition at line 170 of file physics.\+f90.


\begin{DoxyCode}
170 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
171 
172 \textcolor{keywordtype}{IMPLICIT NONE}
173 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}     :: unith      \textcolor{comment}{! One dimensional array with y columns.}
174 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}   :: var        \textcolor{comment}{! Array with x columns and y rows containing
       the variable.}
175 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}   :: u          \textcolor{comment}{! Array with x columns and y rows containing
       U-component of wind.}
176 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}   :: v          \textcolor{comment}{! Array with x columns and y rows containing
       V-component of wind.}
177 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}   :: divu       \textcolor{comment}{! Array with x columns and y rows containing
       DIVU.}
178 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}   :: divv       \textcolor{comment}{! Array with x columns and y rows containing
       DIVV.}
179 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}    :: div1       \textcolor{comment}{! Array with x columns containing divergence.}
180 
181 div1    = matmul((u*var*divu + v*var*divv), unith)
182 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacephysics_adc35216d512f6586071a79fba286a39c_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!fcorlx@{fcorlx}}
\index{fcorlx@{fcorlx}!physics@{physics}}
\subsubsection[{\texorpdfstring{fcorlx(\+U\+N\+I\+T\+H, N\+S\+T\+U, F, V, F\+C\+X1)}{fcorlx(UNITH, NSTU, F, V, FCX1)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::fcorlx (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(nstu), intent(in)}]{U\+N\+I\+TH, }
\item[{integer(kind=ik4), intent(in)}]{N\+S\+TU, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{F, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{V, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{F\+C\+X1}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_a56a179b5bd2c13a2201b2367037a42cf}{}\label{namespacephysics_a56a179b5bd2c13a2201b2367037a42cf}


Definition at line 188 of file physics.\+f90.


\begin{DoxyCode}
188 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
189 
190 \textcolor{keywordtype}{IMPLICIT NONE}
191 \textcolor{keywordtype}{INTEGER(KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                     :: nstu   \textcolor{comment}{! Number of stations}
192 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTU)}, \textcolor{keywordtype}{INTENT(IN)}      :: unith
193 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}       :: f      \textcolor{comment}{! Coriolis parameter at each station and level.}
194 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}       :: v      \textcolor{comment}{! V-wind component at each station and level.}
195 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}        :: fcx1
196 
197 fcx1    = matmul((v*f/nstu), unith)
198 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacephysics_a56a179b5bd2c13a2201b2367037a42cf_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!fcorly@{fcorly}}
\index{fcorly@{fcorly}!physics@{physics}}
\subsubsection[{\texorpdfstring{fcorly(\+U\+N\+I\+T\+H, N\+S\+T\+U, F, U, F\+C\+Y1)}{fcorly(UNITH, NSTU, F, U, FCY1)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::fcorly (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(nstu), intent(in)}]{U\+N\+I\+TH, }
\item[{integer(kind=ik4), intent(in)}]{N\+S\+TU, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{F, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{U, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{F\+C\+Y1}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_a1f64bd544ea55c7fbbf5330725fc0896}{}\label{namespacephysics_a1f64bd544ea55c7fbbf5330725fc0896}


Definition at line 204 of file physics.\+f90.


\begin{DoxyCode}
204 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
205 
206 \textcolor{keywordtype}{IMPLICIT NONE}
207 \textcolor{keywordtype}{INTEGER(KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                     :: nstu   \textcolor{comment}{! Number of stations}
208 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTU)}, \textcolor{keywordtype}{INTENT(IN)}      :: unith
209 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}       :: f      \textcolor{comment}{! Coriolis parameter at each station and level.}
210 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}       :: u      \textcolor{comment}{! U-wind component at each station and level.}
211 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}        :: fcy1
212 
213 fcy1    = matmul((-u*f/nstu), unith)
214 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacephysics_a1f64bd544ea55c7fbbf5330725fc0896_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!fpgd@{fpgd}}
\index{fpgd@{fpgd}!physics@{physics}}
\subsubsection[{\texorpdfstring{fpgd(\+U\+N\+I\+T\+H, Z, D\+Z\+D\+X, F\+P1)}{fpgd(UNITH, Z, DZDX, FP1)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::fpgd (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{U\+N\+I\+TH, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{Z, }
\item[{real (kind=rk8), dimension(\+:,\+:), intent(in)}]{D\+Z\+DX, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{F\+P1}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{}\label{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}


Definition at line 220 of file physics.\+f90.


\begin{DoxyCode}
220 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
221 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
222 
223 \textcolor{keywordtype}{IMPLICIT NONE}
224 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}     :: unith
225 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}   :: z
226 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{INTENT(IN)}   :: dzdx
227 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}    :: fp1
228 
229 fp1 = matmul((-\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*z*dzdx), unith)
230 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacephysics_acf841366af6f4fd7502b4031a2cacb56_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!height@{height}}
\index{height@{height}!physics@{physics}}
\subsubsection[{\texorpdfstring{height(\+N\+P, K\+S, K\+T, P, T, R, Z)}{height(NP, KS, KT, P, T, R, Z)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::height (
\begin{DoxyParamCaption}
\item[{integer (kind=ik4), intent(in)}]{NP, }
\item[{integer (kind=ik4), intent(in)}]{KS, }
\item[{integer (kind=ik4), intent(in)}]{KT, }
\item[{real (kind=rk8), dimension(np), intent(in)}]{P, }
\item[{real (kind=rk8), dimension(np), intent(in)}]{T, }
\item[{real (kind=rk8), dimension(np), intent(in)}]{R, }
\item[{real (kind=rk8), dimension(np), intent(out)}]{Z}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_a0ca41ce81224f2d7b292dc474c080c60}{}\label{namespacephysics_a0ca41ce81224f2d7b292dc474c080c60}


Definition at line 244 of file physics.\+f90.


\begin{DoxyCode}
244 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
245 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
246 
247 \textcolor{keywordtype}{IMPLICIT NONE}
248 
249 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                :: np         \textcolor{comment}{! Number of pressure levels in the P, T, R and
       Z arrays.}
250 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                :: ks         \textcolor{comment}{! The level which the surface is at.}
251 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                :: kt         \textcolor{comment}{! Level at which the variational analysis
       stops.}
252 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(IN)}    :: p          \textcolor{comment}{! Pressure of each level.}
253 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(IN)}    :: t          \textcolor{comment}{! Temperature of each level.}
254 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(IN)}    :: r          \textcolor{comment}{! Mixing ratio at each level?}
255 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(OUT)}   :: z          \textcolor{comment}{! Geopotential height.}
256 
257 \textcolor{comment}{!}
258 \textcolor{comment}{! Local variables.}
259 \textcolor{comment}{!}
260 \textcolor{keywordtype}{REAL (KIND=RK8)}                               :: ep, r1, dz \textcolor{comment}{! Temporary variables.}
261 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                            :: kk         \textcolor{comment}{! Counter.}
262 
263 ep  = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}/\hyperlink{namespaceconstants_a7ef8fc37397fbfbefd3c22883378dcc5}{rw}
264 
265 \textcolor{keywordflow}{DO} kk=ks+1,kt
266     r1      = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}*0.5*((1+r(kk-1)/ep)/(1+r(kk-1))+(1+r(kk)/ep)/(1+r(kk)))
267     dz      = r1/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*0.5*(t(kk-1)/p(kk-1)+t(kk)/p(kk))*(p(kk-1)-p(kk))
268     z(kk)   = z(kk-1)+dz
269 \textcolor{keywordflow}{END DO}
270 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacephysics_a0ca41ce81224f2d7b292dc474c080c60_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!s\+\_\+r\+\_\+to\+\_\+t\+\_\+z@{s\+\_\+r\+\_\+to\+\_\+t\+\_\+z}}
\index{s\+\_\+r\+\_\+to\+\_\+t\+\_\+z@{s\+\_\+r\+\_\+to\+\_\+t\+\_\+z}!physics@{physics}}
\subsubsection[{\texorpdfstring{s\+\_\+r\+\_\+to\+\_\+t\+\_\+z(\+P, P\+S, Z\+S, S, R, T, Z)}{s_r_to_t_z(P, PS, ZS, S, R, T, Z)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::s\+\_\+r\+\_\+to\+\_\+t\+\_\+z (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{P, }
\item[{real (kind=rk8), intent(in)}]{PS, }
\item[{real (kind=rk8), intent(in)}]{ZS, }
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{S, }
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{R, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{T, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{Z}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_a3f1959e7b3ff1a8d052f1e0441b1c379}{}\label{namespacephysics_a3f1959e7b3ff1a8d052f1e0441b1c379}


Definition at line 22 of file physics.\+f90.


\begin{DoxyCode}
22 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
23 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
24 
25 \textcolor{keywordtype}{IMPLICIT NONE}
26 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}       :: p    \textcolor{comment}{! Pressures of a vertical column (hPa)}
27 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                     :: ps   \textcolor{comment}{! Surface pressure (hPa)}
28 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                     :: zs   \textcolor{comment}{! Surface geopotential height (m)}
29 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}       :: s    \textcolor{comment}{! (K)}
30 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}       :: r    \textcolor{comment}{! Mixing ration (g/kg)}
31 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}      :: t    \textcolor{comment}{! Temperature at each level (K)}
32 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}      :: z    \textcolor{comment}{! Geopotential height at each level (m)}
33 
34 \textcolor{comment}{!}
35 \textcolor{comment}{! Local variables.}
36 \textcolor{comment}{!}
37 \textcolor{keywordtype}{REAL (KIND=RK8)}                                 :: g2       \textcolor{comment}{! 2*G}
38 \textcolor{keywordtype}{REAL (KIND=RK8)}                                 :: ep       \textcolor{comment}{! RD/RW}
39 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                              :: ii       \textcolor{comment}{! Counter}
40 \textcolor{keywordtype}{REAL (KIND=RK8)}                                 :: rv, a1, p1, t1, r1, z1, p2, r2
41 
42 \textcolor{comment}{!}
43 \textcolor{comment}{! Assign and initialise some variables.}
44 \textcolor{comment}{!}
45 g2  = 2.0*\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
46 ep  = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}/\hyperlink{namespaceconstants_a7ef8fc37397fbfbefd3c22883378dcc5}{rw}
47 t   = 0.0
48 z   = 0.0
49 
50 \textcolor{keywordflow}{WHERE} (p .GE. ps)
51     z   = zs
52     t   = s(1) - \hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*zs/\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}
53 \textcolor{keywordflow}{END WHERE}
54 
55 p1  = ps
56 t1  = t(1)
57 r1  = r(1)
58 z1  = zs
59 
60 \textcolor{keywordflow}{DO} ii=transfer(maxloc(p, mask=p.LT.ps), 0),\textcolor{keyword}{SIZE}(p)
61     p2      = p(ii)
62     r2      = r(ii)
63     rv      = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}*0.5*((1+r1/ep)/(1+r1)+(1+r2/ep)/(1+r2))
64     a1      = rv/2.0/\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}*log(p1/p2)
65     t(ii)   = (s(ii) - \hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}/\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}*z1 - a1*t1)/(1.0 + a1)
66     z(ii)   = z1 + rv*(t1+t(ii))/g2*log(p1/p2)
67 
68     p1      = p2
69     r1      = r2
70     z1      = z(ii)
71     t1      = t(ii)
72 \textcolor{keywordflow}{END DO}
73 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacephysics_a3f1959e7b3ff1a8d052f1e0441b1c379_icgraph}
\end{center}
\end{figure}


\index{physics@{physics}!t\+\_\+r\+\_\+to\+\_\+s\+\_\+z@{t\+\_\+r\+\_\+to\+\_\+s\+\_\+z}}
\index{t\+\_\+r\+\_\+to\+\_\+s\+\_\+z@{t\+\_\+r\+\_\+to\+\_\+s\+\_\+z}!physics@{physics}}
\subsubsection[{\texorpdfstring{t\+\_\+r\+\_\+to\+\_\+s\+\_\+z(\+P, P\+S, Z\+S, T, R, S, Z)}{t_r_to_s_z(P, PS, ZS, T, R, S, Z)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine physics\+::t\+\_\+r\+\_\+to\+\_\+s\+\_\+z (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{P, }
\item[{real (kind=rk8), intent(in)}]{PS, }
\item[{real (kind=rk8), intent(in)}]{ZS, }
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{T, }
\item[{real (kind=rk8), dimension(\+:), intent(in)}]{R, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{S, }
\item[{real (kind=rk8), dimension(\+:), intent(out)}]{Z}
\end{DoxyParamCaption}
)}\hypertarget{namespacephysics_aebc42cd426e3ef8e85696bb1c7da18c3}{}\label{namespacephysics_aebc42cd426e3ef8e85696bb1c7da18c3}


Definition at line 87 of file physics.\+f90.


\begin{DoxyCode}
87 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
88 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
89 
90 \textcolor{keywordtype}{IMPLICIT NONE}
91 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                             :: ps       \textcolor{comment}{! Surface pressure (hPa).}
92 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                             :: zs       \textcolor{comment}{! Surface geopotential height (m).}
93 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}               :: p        \textcolor{comment}{! Pressure levels (hPa).}
94 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}               :: t        \textcolor{comment}{! Temperature (K).}
95 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(IN)}               :: r        \textcolor{comment}{! Mixing ration (g/kg).}
96 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}              :: s        \textcolor{comment}{! Dry static energy divided by CPD (K).}
97 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{INTENT(OUT)}              :: z        \textcolor{comment}{! Geopotential height (m).}
98 
99 \textcolor{comment}{!}
100 \textcolor{comment}{! Local variables.}
101 \textcolor{comment}{!}
102 \textcolor{keywordtype}{REAL (KIND=RK8)}                                         :: ep, g2, p1, t1, r1, p2, r2, t2, rv
103 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                      :: ll       \textcolor{comment}{! Counter.}
104 
105 \textcolor{comment}{!}
106 \textcolor{comment}{! Do some basic checks of the input data. This is an unfortunate necessity (otherwise bad input data can
       cause overflows in the}
107 \textcolor{comment}{! calculations. If bad data are detected, set the geopotential height and dry static energy to an undefined
       value (-9999.99)}
108 \textcolor{comment}{!}
109 
110 
111 
112 \textcolor{keywordflow}{IF} ((ps .LE. 0) .OR. (minval(p) .LE. 0) .OR. (minval(t) .LT. 0) .OR. (minval(r) .LT. 0)) \textcolor{keywordflow}{THEN}
113     s   = -9999.99
114     z   = -9999.99
115     \textcolor{keywordflow}{RETURN}
116 \textcolor{keywordflow}{END IF}
117 
118 \textcolor{comment}{!}
119 \textcolor{comment}{! Set some variables which are frequently used.}
120 \textcolor{comment}{!}
121 ep  = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}/\hyperlink{namespaceconstants_a7ef8fc37397fbfbefd3c22883378dcc5}{rw}
122 g2  = 2.0*\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
123 
124 \textcolor{comment}{!}
125 \textcolor{comment}{! Where P is greater than PS, we are presumably below the surface. Set the geopotential height and dry
       static energy to surface}
126 \textcolor{comment}{! values. We also ensure the geopotential height of the lowest level is the same as the surface.}
127 \textcolor{comment}{!}
128 
129 z(1)    = zs
130 z       = 0
131 s       = 0
132 
133 \textcolor{keywordflow}{WHERE} (p .GE. ps)
134     z   = zs
135     s   = t(1) + \hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*zs/\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}
136 \textcolor{keywordflow}{END WHERE}
137 
138 \textcolor{comment}{!}
139 \textcolor{comment}{! For each non-surface level, calculate the geopotential height and dry static energy.}
140 \textcolor{comment}{!}
141 p1  = ps
142 t1  = t(1)
143 r1  = r(1)
144 \textcolor{keywordflow}{DO} ll=max(1,transfer(maxloc(p, mask=p.LT.ps), 0)),\textcolor{keyword}{SIZE}(p)
145     p2      = p(ll)
146     t2      = t(ll)
147     r2      = r(ll)
148     rv      = \hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}*0.5*((1+r1/ep)/(1+r1) + (1+r2/ep)/(1+r2))
149     \textcolor{keywordflow}{IF} (ll.gt.1)  z(ll)   = z(ll-1) + rv*(t1+t2)/g2*log(p1/p2)
150     t1      = t2
151     p1      = p2
152     r1      = r2
153     s(ll)   = t(ll) + \hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}*z(ll)/\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}
154 \textcolor{keywordflow}{END DO}
155 
156 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=264pt]{namespacephysics_aebc42cd426e3ef8e85696bb1c7da18c3_icgraph}
\end{center}
\end{figure}


