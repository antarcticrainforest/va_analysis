\hypertarget{namespacenumerics}{}\section{numerics Module Reference}
\label{namespacenumerics}\index{numerics@{numerics}}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{namespacenumerics_ac972e0e69239cba641ad373fee101472}{itps} (KS, KB, D, DS)
\item 
subroutine \hyperlink{namespacenumerics_afbd04035bb50e63d44980bf39cf84ac3}{gmean} (MG, DP, NV, N\+ST, NT, T\+S\+M\+O\+O\+TH)
\item 
subroutine \hyperlink{namespacenumerics_a354d8c793bd1515de7af7cfa32c51389}{smooth} (A\+R\+R\+AY, N, F\+I\+L\+T\+E\+R\+\_\+\+W\+I\+D\+TH, C\+Y\+C\+L\+IC)
\item 
subroutine \hyperlink{namespacenumerics_add44a47f4f996c0266711b825fd6bb20}{caldev} (DU, KT, KS, N\+S\+TU, N\+TU, NP, N\+VU, D\+E\+V\+M2)
\item 
subroutine \hyperlink{namespacenumerics_a9581a41d0b81a5ded9690972e499c629}{horizontal\+\_\+field} (N\+ST, L\+ON, L\+AT, X, Y, F, D\+Z\+DX, D\+Z\+DY, D\+I\+VU, D\+I\+VV)
\item 
subroutine \hyperlink{namespacenumerics_a8e58d8bf1c738af1a91517fdb8b81aa2}{line\+\_\+fit\+\_\+xyz} (N, X, Y, Z, D\+Z\+DX, D\+Z\+DY, Z0)
\item 
subroutine \hyperlink{namespacenumerics_aa16b459eac85058fd1da1b9ebc4555b9}{windown} (N, X, DX, X1, L0, L1)
\item 
subroutine \hyperlink{namespacenumerics_acc1dd6ef9a4cf200fd7701143c4ae29e}{assim} (NP, DP, P, KS, KB, KT, N\+S\+TU, L\+O\+NU, L\+A\+TU, DU, N\+S\+TS, L\+O\+NS, L\+A\+TS, D\+SS, D\+I\+V\+B\+V\+AR, F\+CX, F\+CY, F\+PX, F\+PY, B\+U\+D\+G\+ET, N\+A\+D\+V\+AR, W\+V\+AR, D\+US)
\item 
subroutine \hyperlink{namespacenumerics_adbe2d748ef22c981cddde813d1db9d77}{calc\+\_\+budget\+\_\+layer} (NP, N\+TU, P, B\+U\+D\+G\+E\+T\+\_\+\+L\+A\+Y\+ER, B\+U\+D\+G\+E\+T\+\_\+\+C\+O\+L\+U\+M\+NS, A\+V\+E\+\_\+\+QS, A\+V\+E\+\_\+\+SS)
\end{DoxyCompactItemize}


\subsection{Function/\+Subroutine Documentation}
\index{numerics@{numerics}!assim@{assim}}
\index{assim@{assim}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{assim(\+N\+P, D\+P, P, K\+S, K\+B, K\+T, N\+S\+T\+U, L\+O\+N\+U, L\+A\+T\+U, D\+U, N\+S\+T\+S, L\+O\+N\+S, L\+A\+T\+S, D\+S\+S, D\+I\+V\+B\+V\+A\+R, F\+C\+X, F\+C\+Y, F\+P\+X, F\+P\+Y, B\+U\+D\+G\+E\+T, N\+A\+D\+V\+A\+R, W\+V\+A\+R, D\+U\+S)}{assim(NP, DP, P, KS, KB, KT, NSTU, LONU, LATU, DU, NSTS, LONS, LATS, DSS, DIVBVAR, FCX, FCY, FPX, FPY, BUDGET, NADVAR, WVAR, DUS)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::assim (
\begin{DoxyParamCaption}
\item[{integer (kind=ik4), intent(in)}]{NP, }
\item[{real (kind=rk8), intent(in)}]{DP, }
\item[{real (kind=rk8), dimension(np), intent(in)}]{P, }
\item[{integer (kind=ik4), intent(in)}]{KS, }
\item[{integer (kind=ik4), intent(in)}]{KB, }
\item[{integer (kind=ik4), intent(in)}]{KT, }
\item[{integer (kind=ik4), intent(in)}]{N\+S\+TU, }
\item[{real (kind=rk8), dimension(nstu), intent(in)}]{L\+O\+NU, }
\item[{real (kind=rk8), dimension(nstu), intent(in)}]{L\+A\+TU, }
\item[{real (kind=rk8), dimension(nvu,np,nstu), intent(inout)}]{DU, }
\item[{integer (kind=ik4), intent(in)}]{N\+S\+TS, }
\item[{real (kind=rk8), dimension(nsts), intent(in)}]{L\+O\+NS, }
\item[{real (kind=rk8), dimension(nsts), intent(in)}]{L\+A\+TS, }
\item[{real (kind=rk8), dimension(nvs, nsts), intent(inout)}]{D\+SS, }
\item[{real (kind=rk8), dimension(nvbudget\+\_\+layer,np), intent(out)}]{D\+I\+V\+B\+V\+AR, }
\item[{real (kind=rk8), dimension(np), intent(out)}]{F\+CX, }
\item[{real (kind=rk8), dimension(np), intent(out)}]{F\+CY, }
\item[{real (kind=rk8), dimension(np), intent(out)}]{F\+PX, }
\item[{real (kind=rk8), dimension(np), intent(out)}]{F\+PY, }
\item[{real (kind=rk8), dimension(nvbudget\+\_\+column, ntermmax), intent(inout)}]{B\+U\+D\+G\+ET, }
\item[{integer (kind=ik4), intent(in)}]{N\+A\+D\+V\+AR, }
\item[{real (kind=rk8), dimension(5,np, nstu), intent(inout)}]{W\+V\+AR, }
\item[{real (kind=rk8), dimension(nvu,np,nstu), intent(out)}]{D\+US}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_acc1dd6ef9a4cf200fd7701143c4ae29e}{}\label{namespacenumerics_acc1dd6ef9a4cf200fd7701143c4ae29e}


Definition at line 429 of file numerics.\+f90.


\begin{DoxyCode}
429 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
430 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
431 \textcolor{keywordtype}{USE }\hyperlink{namespacesettings}{settings}
432 \textcolor{keywordtype}{USE }\hyperlink{namespacelu}{lu}
433 \textcolor{keywordtype}{USE }\hyperlink{namespacephysics}{physics}
434 
435 \textcolor{keywordtype}{IMPLICIT NONE}
436 
437 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                      :: np       \textcolor{comment}{! Number of pressure
       levels.}
438 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                                         :: dp       \textcolor{comment}{! Spacing of the pressure
       levels (Pa).}
439 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(IN)}                          :: p        \textcolor{comment}{! Pressure of each level
       (hPa)}
440 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                      :: ks       \textcolor{comment}{! Index of level where the
       surface pressure is.}
441 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                      :: kb       \textcolor{comment}{! Index of level where the
       surface is.}
442 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                      :: kt       \textcolor{comment}{! Index of the top level.}
443 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                      :: nstu     \textcolor{comment}{! Number of upper air
       stations.}
444 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTU)}, \textcolor{keywordtype}{INTENT(IN)}                        :: lonu     \textcolor{comment}{! Longitudes of the upper
       air stations}
445 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTU)}, \textcolor{keywordtype}{INTENT(IN)}                        :: latu     \textcolor{comment}{! Latitudes of the upper
       air stations}
446 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVU,NP,NSTU)}, \textcolor{keywordtype}{INTENT(INOUT)}              :: du       \textcolor{comment}{! Array containing all the
       upper level data.}
447                                                                                 \textcolor{comment}{! DU(1,:,:)   = 1.0}
448                                                                                 \textcolor{comment}{! DU(2,:,:)   = rLv0/cpd}
449                                                                                 \textcolor{comment}{! DU(3,:,:)   = dry static
       energy}
450                                                                                 \textcolor{comment}{! DU(4,:,:)   = u}
451                                                                                 \textcolor{comment}{! DU(5,:,:)   = v}
452                                                                                 \textcolor{comment}{! DU(6,:,:)   = T}
453                                                                                 \textcolor{comment}{! DU(7,:,:)   = z}
454                                                                                 \textcolor{comment}{! DU(8,:,:)   = P}
455                                                                                 \textcolor{comment}{! DU(9,:,:)   = lon}
456                                                                                 \textcolor{comment}{! DU(10,:,:)  = lat}
457 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                      :: nsts     \textcolor{comment}{! Number of surface level
       stations}
458 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTS)}, \textcolor{keywordtype}{INTENT(IN)}                        :: lons     \textcolor{comment}{! Longitudes of the surface
       stations.}
459 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTS)}, \textcolor{keywordtype}{INTENT(IN)}                        :: lats     \textcolor{comment}{! Latitudes of the surface
       stations.}
460 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVS, NSTS)}, \textcolor{keywordtype}{INTENT(INOUT)}                :: dss      \textcolor{comment}{! Array containing all the
       surface level data.}
461 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_LAYER,NP)}, \textcolor{keywordtype}{INTENT(OUT)}          :: divbvar  \textcolor{comment}{!}
462 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(OUT)}                         :: fcx      \textcolor{comment}{!}
463 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(OUT)}                         :: fcy      \textcolor{comment}{!}
464 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(OUT)}                         :: fpx      \textcolor{comment}{!}
465 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(OUT)}                         :: fpy      \textcolor{comment}{!}
466 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_COLUMN, NTERMMAX)}, \textcolor{keywordtype}{INTENT(INOUT)}:: budget   \textcolor{comment}{!}
467 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                      :: nadvar   \textcolor{comment}{!}
468 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(5,NP, NSTU)}, \textcolor{keywordtype}{INTENT(INOUT)}               :: wvar     \textcolor{comment}{!}
469 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVU,NP,NSTU)}, \textcolor{keywordtype}{INTENT(OUT)}                :: dus      \textcolor{comment}{!}
470 
471 \textcolor{comment}{!}
472 \textcolor{comment}{! Local variables.}
473 \textcolor{comment}{!}
474 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: f                \textcolor{comment}{! Coriolis parameter at each
       station and level.}
475 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: dzdx             \textcolor{comment}{! }
476 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: dzdy             \textcolor{comment}{!}
477 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: divu             \textcolor{comment}{!}
478 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: divv             \textcolor{comment}{!}
479 
480 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTU)}                    :: x                \textcolor{comment}{! Cartesian x-coords of the
       stations at a single level.}
481 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTU)}                    :: y                \textcolor{comment}{! Cartesian y-coords of the
       stations at a single level.}
482 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTS)}                    :: xs               \textcolor{comment}{! Cartesian x-coords of the surface
       stations.}
483 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTS)}                    :: ys               \textcolor{comment}{! Cartesian y-coords of the surface
       stations.}
484 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1,NSTS)}                  :: fs               \textcolor{comment}{! Coriolis parameters of the
       surface stations.}
485 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1,NSTS)}                  :: dzdxs            \textcolor{comment}{! DZDX of the surface stations.}
486 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1,NSTS)}                  :: dzdys            \textcolor{comment}{! DZDY of the surface stations.}
487 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1,NSTS)}                  :: divus            \textcolor{comment}{! DIVU of the surface stations.}
488 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1,NSTS)}                  :: divvs            \textcolor{comment}{! DIVV of the surface stations.}
489 
490 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                  :: kk, mm, ist, mb, mb1, mvar, mad   \textcolor{comment}{! Counters.}
491 \textcolor{keywordtype}{REAL (KIND=RK8)}                                     :: two      = 2.0
492 \textcolor{keywordtype}{REAL(KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(5)}                        :: ad       = 1.0   \textcolor{comment}{!}
493 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                  :: nterm            \textcolor{comment}{!}
494 
495 \textcolor{comment}{! The IDL code is messy ... these were all declared for the first time in the middle of other stuff.}
496 \textcolor{comment}{! For safety, we initialise many of the variables to 0 (unless the IDL code specifies otherwise). Actually,
       if you look at}
497 \textcolor{comment}{! the accompanying make files, you'll see I use a g95 option for initially zeroing variables when they are
       declared.}
498 
499 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTU)}                    :: unith
500 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NSTS)}                    :: uniths
501 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: unitv
502 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: unitv1
503 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_COLUMN)}         :: c
504 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_COLUMN)}         :: b
505 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_COLUMN, NVBUDGET\_COLUMN, NP, NSTU)}    :: dbdvar   \textcolor{comment}{! Important one.}
506 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_COLUMN, NVBUDGET\_COLUMN)}              :: a
507 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_COLUMN)}                               :: ld
508 
509 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: bvar
510 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: unitvar                      \textcolor{comment}{! This is called UNIT
       in the IDL code.}
511 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: u
512 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: v
513 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: r
514 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: h
515 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: z 
516 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: t
517 
518 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: bvar1
519 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: u1
520 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: v1
521 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: r2
522 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: h2
523 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: z2
524 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP, NSTU)}                :: z1
525 
526 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1, NSTS)}                 :: bvars
527 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1, NSTS)}                 :: us
528 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1, NSTS)}                 :: vs
529 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1, NSTS)}                 :: zs
530 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1, NSTS)}                 :: ts
531 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{DIMENSION(4)}                    :: madn = (/ 4, 5, 2, 3 /) 
532 
533 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NAD, NAD)}                :: a1
534 \textcolor{comment}{!REAL (KIND=RK8), DIMENSION(NAD, NAD)                :: A2}
535 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NAD)}                     :: b1, ld1
536 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: div1, div2               \textcolor{comment}{! Divergences, for NP
       levels.}
537 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1)}                       :: divs                     \textcolor{comment}{! Divergence for a single
       level.}
538 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: fcx1, fpx1, fcy1, fpy1
539 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(1)}                       :: fcxs, fcys, fpxs, fpys
540 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                  :: d, code
541 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{DIMENSION(NAD)}                  :: indx
542 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}                      :: sc, rc
543 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP,NSTU)}                      :: old1, old2,test1,test2               \textcolor{comment}{!
       Divergences, for NP levels.}
544 
545 \textcolor{comment}{!}
546 \textcolor{comment}{! What a lot of stuff that was ... surely it can be reduced!}
547 \textcolor{comment}{!}
548 \textcolor{comment}{! Initialise a whole lot of variables. For safety, we initialise lots of things with 0.0 (unless the IDL
       code specified otherwise).}
549 \textcolor{comment}{! This is because Fortran does not guarantee that variables will be initialised to any particular value
       when they are declared.}
550 \textcolor{comment}{!}
551 f       = 0.0
552 dzdx    = 0.0   
553 dzdy    = 0.0
554 divu    = 0.0
555 divv    = 0.0
556 x       = 0.0
557 y       = 0.0
558 xs      = 0.0
559 ys      = 0.0
560 fs      = 0.0
561 dzdxs   = 0.0
562 dzdys   = 0.0
563 divus   = 0.0
564 divvs   = 0.0
565 unith   = 1.0
566 uniths  = 1.0
567 unitv   = 0.0
568 unitv1  = 0.0
569 c       = 0.0
570 b       = 0.0
571 dbdvar  = 0.0
572 a       = 0.0
573 ld      = 0.0
574 bvar    = 0.0
575 unitvar = 0.0
576 u       = 0.0
577 v       = 0.0
578 r       = 0.0
579 h       = 0.0
580 z       = 0.0
581 t       = 0.0
582 bvar1   = 0.0
583 u1      = 0.0
584 v1      = 0.0
585 r2      = 0.0
586 h2      = 0.0
587 z2      = 0.0
588 z1      = 0.0
589 bvars   = 0.0
590 us      = 0.0
591 vs      = 0.0
592 zs      = 0.0
593 ts      = 0.0
594 a1      = 0.0
595 \textcolor{comment}{!A2      = 0.0}
596 b1      = 0.0
597 ld1     = 0.0
598 div1    = 0.0
599 div2    = 0.0
600 divs    = 0.0
601 fcx1    = 0.0
602 fpx1    = 0.0
603 fcy1    = 0.0
604 fpy1    = 0.0
605 fcxs    = 0.0
606 fcys    = 0.0
607 fpxs    = 0.0
608 fpys    = 0.0
609 d       = 0
610 code    = 0
611 indx    = 0
612 sc      = 0.0
613 rc      = 0.0
614 old1    = 0.0
615 old2    = 0.0
616 test1 = 0.0
617 test2 = 0.0
618 \textcolor{comment}{!}
619 \textcolor{comment}{! Calculate the components of the horizontal gradient and divergence at each vertical level, and at the
       surface.}
620 \textcolor{comment}{! All the temporary arrays used in the IDL procedure have been replaced by Fortran 90 array sections.
       Simplifies}
621 \textcolor{comment}{! things a bit.}
622 \textcolor{comment}{!}
623 
624 \textcolor{keywordflow}{DO} kk=kb,kt
625     \textcolor{keyword}{CALL }horizontal\_field(nstu, du(9,kk,:), du(10,kk,:), x, y, f(kk,:), dzdx(kk,:), dzdy(kk,:), divu(kk,:),
       divv(kk,:))
626 \textcolor{keywordflow}{END DO}
627 
628 \textcolor{keyword}{CALL }horizontal\_field(nsts, lons, lats, xs, ys, fs, dzdxs, dzdys, divus, divvs)
629 \textcolor{keywordflow}{DO} mm=1,5
630     wvar(mm,:,:)=wvar(mm,:,:)/ad(mm)
631 \textcolor{keywordflow}{END DO}
632 
633 \textcolor{keywordflow}{DO} mm=1,\hyperlink{namespacesettings_a78876a80ce867f4bc71866b783b6de89}{nvbudget\_column}
634     du(mm,1:np,1:nstu) = du(mm,1:np,1:nstu)*ad(mm)
635     dss(mm,1:nsts)=dss(mm,1:nsts)*ad(mm)
636     nterm=int(budget(mm,1), kind=\hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
637     budget(mm,2:nterm+2)=budget(mm,2:nterm+2)*ad(mm)
638 \textcolor{keywordflow}{END DO}
639 
640 \textcolor{comment}{!}
641 \textcolor{comment}{! Initialise more variables.}
642 \textcolor{comment}{!}
643 dus             = du
644 
645 unitv(kb:kt)    = 1.0
646 unitv1(ks:kt)   = 1.0
647 unitv1(ks)      = 0.5 + (budget(1,7) - p(ks))/dp*100.
648 unitv1(kt)      = 0.5
649 unitv(kb)       = 0.5 + (budget(1,7) - p(kb))/dp*100.
650 unitv(kt)       = 0.5
651 
652 \textcolor{comment}{!}
653 \textcolor{comment}{! Print a warning if the surface level is different than the level at which surface pressure is located
       (they should be}
654 \textcolor{comment}{! the same).}
655 \textcolor{comment}{!}
656 \textcolor{keywordflow}{IF} (kb .NE. ks) \textcolor{keywordflow}{THEN}
657     print *,\textcolor{stringliteral}{'Warning: KB different from KS. Try to make them the same'}
658 \textcolor{keywordflow}{END IF}
659 
660 \textcolor{comment}{!}
661 \textcolor{comment}{! Do more stuff.}
662 \textcolor{comment}{!}
663 \textcolor{keywordflow}{DO} mb=1,\hyperlink{namespacesettings_a78876a80ce867f4bc71866b783b6de89}{nvbudget\_column}
664     nterm   = int(budget(mb, 1), 4)
665     c(mb)   = -sum(budget(mb,3:nterm+1))
666 \textcolor{keywordflow}{END DO}
667 
668 \textcolor{comment}{!}
669 \textcolor{comment}{! Fill out UNITVAR, R, H, U, V, Z and T from the big DUS array (which was passed into this procedure as DU)}
670 \textcolor{comment}{!}
671 unitvar(kb:kt,:)    = dus(1,kb:kt,:)
672 r(kb:kt,:)          = dus(2,kb:kt,:)
673 h(kb:kt,:)          = dus(3,kb:kt,:)
674 u(kb:kt,:)          = dus(4,kb:kt,:)
675 v(kb:kt,:)          = dus(5,kb:kt,:)
676 z(kb:kt,:)          = dus(7,kb:kt,:)
677 t(kb:kt,:)          = dus(6,kb:kt,:)
678 
679 \textcolor{comment}{!}
680 \textcolor{comment}{! Fill out US, VS, ZS and TS from the big DSS array.}
681 \textcolor{comment}{!}
682 us(1,:)             = dss(4,:)
683 vs(1,:)             = dss(5,:)
684 zs(1,:)             = dss(7,:)
685 ts(1,:)             = dss(6,:)
686 
687 \textcolor{comment}{!}
688 \textcolor{comment}{! I think this is where the partial derivatives to the five constraint equations (equations (14)-(17) in
       Zhang and Lin) are}
689 \textcolor{comment}{! calculated ... maybe.}
690 \textcolor{comment}{!}
691 \textcolor{keywordflow}{DO} kk=kb,kt
692     dbdvar(1,1,kk,:)    = unitvar(kk,:)*divu(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
693     dbdvar(1,2,kk,:)    = unitvar(kk,:)*divv(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
694     dbdvar(2,1,kk,:)    = r(kk,:)*divu(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
695     dbdvar(2,2,kk,:)    = r(kk,:)*divv(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
696     dbdvar(2,3,kk,:)    = (u(kk,:)*divu(kk,:) + v(kk,:)*divv(kk,:))*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
697     dbdvar(3,1,kk,:)    = h(kk,:)*divu(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
698     dbdvar(3,2,kk,:)    = h(kk,:)*divv(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
699     dbdvar(3,4,kk,:)    = (u(kk,:)*divu(kk,:) + v(kk,:)*divv(kk,:))*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
700     dbdvar(4,1,kk,:)    = (2.0*u(kk,:)*divu(kk,:) + v(kk,:)*divv(kk,:))*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
701     dbdvar(4,2,kk,:)    = (u(kk,:)*divv(kk,:) - f(kk,:)/nstu)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
702     dbdvar(4,4,kk,:)    = (kt+1-kk)*\hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}*dp/100.0/p(kk)*dzdx(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
703     dbdvar(5,1,kk,:)    = (v(kk,:)*divu(kk,:) + f(kk,:)/nstu)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
704     dbdvar(5,2,kk,:)    = (u(kk,:)*divu(kk,:) + 2.0*v(kk,:)*divv(kk,:))*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
705     dbdvar(5,4,kk,:)    = (kt+1-kk)*\hyperlink{namespaceconstants_ad91564da82b97ea0d29ce0565565db85}{rd}*dp/100.0/p(kk)*dzdy(kk,:)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
706 \textcolor{keywordflow}{END DO}
707 
708 \textcolor{keywordflow}{DO} mb=1,5                   \textcolor{comment}{! This loops over the first five variables in the dus array.}
709     bvar(kb:kt,:)       = dus(mb,kb:kt,:)
710     bvars(1,:)          = dss(mb,:)
711 
712     \textcolor{keywordflow}{DO} mb1=1,5
713         \textcolor{keywordflow}{DO} ist=1,nstu
714             \textcolor{keywordflow}{DO} kk=kb,kt
715                 u1(kk,ist)  = -dbdvar(mb1,1,kk,ist)/two/wvar(4,kk,ist)
716                 v1(kk,ist)  = -dbdvar(mb1,2,kk,ist)/two/wvar(5,kk,ist)
717                 r2(kk)      = 0.0
718                 h2(kk)      = -dbdvar(mb1,4,kk,ist)/two/wvar(3,kk,ist)
719                 test1(kk,ist)=-wvar(4,kk,ist)
720                 test2(kk,ist)=-wvar(5,kk,ist)
721 \textcolor{keywordflow}{            END DO}
722             \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a0ca41ce81224f2d7b292dc474c080c60}{height}(np, kb, kt, p, h2, r2, z2)
723             z1(:,ist)       = z2(:)
724 \textcolor{keywordflow}{        END DO}
725         \textcolor{keyword}{CALL }\hyperlink{namespacephysics_adc35216d512f6586071a79fba286a39c}{diverg}(unith=unith, var=bvar, u=u1, v=v1, divu=divu, divv=divv, div1=div2)
726         a(mb,mb1)           = dot\_product(div2,unitv)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}          \textcolor{comment}{! Equivalent to IDL code:
       transpose(div2)#unitv*dp/g}
727         \textcolor{comment}{!}
728         \textcolor{comment}{! Print a warning if ABS(MB,MB1) is greater than 100.}
729         \textcolor{comment}{!}
730         \textcolor{comment}{!IF (ABS(A(MB,MB1)) .GT. 100) THEN}
731             \textcolor{comment}{!PRINT *,'Warning: A(MB,MB1) > 100',MB,MB1,A(MB,MB1)!,DIV2,'..',UNITV ,'..',DP,'..',G}
732             \textcolor{comment}{!  print *, OLD1,'....',test1,'#',MB1}
733             \textcolor{comment}{!  print *, OLD2,'....',test2,'#',MB1}
734         \textcolor{comment}{!else}
735         \textcolor{comment}{!    print *, U1,'...#....',V1}
736         \textcolor{comment}{!END IF}
737         old1=test1
738         old2=test2
739         \textcolor{comment}{!}
740         \textcolor{comment}{! Calculate extra stuff for MB=4}
741         \textcolor{comment}{!}
742         \textcolor{keywordflow}{IF} (mb .EQ. 4) \textcolor{keywordflow}{THEN}
743             \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a56a179b5bd2c13a2201b2367037a42cf}{fcorlx}(unith, nstu, f, v1, fcx1)
744             \textcolor{keyword}{CALL }\hyperlink{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{fpgd}(unith, z1, dzdx, fpx1)
745             a(4,mb1)    = a(4,mb1) - dot\_product(fcx1,unitv)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g} - dot\_product(fpx1,unitv)*dp/
      \hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
746 \textcolor{keywordflow}{        END IF}
747 
748         \textcolor{comment}{!}
749         \textcolor{comment}{! Calculate extra stuff for MB=5}
750         \textcolor{comment}{!}
751         \textcolor{keywordflow}{IF} (mb .EQ. 5) \textcolor{keywordflow}{THEN}
752             \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a1f64bd544ea55c7fbbf5330725fc0896}{fcorly}(unith, nstu, f, u1, fcy1)
753             \textcolor{keyword}{CALL }\hyperlink{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{fpgd}(unith, z1, dzdy, fpy1)
754             a(5,mb1)    = a(5,mb1) - dot\_product(fcy1,unitv)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g} - dot\_product(fpy1,unitv)*dp/
      \hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
755 \textcolor{keywordflow}{        END IF}
756 \textcolor{keywordflow}{    END DO}
757 
758     \textcolor{keyword}{CALL }\hyperlink{namespacephysics_adc35216d512f6586071a79fba286a39c}{diverg}(unith, bvar, u, v, divu, divv, div1)
759     \textcolor{keyword}{CALL }\hyperlink{namespacephysics_adc35216d512f6586071a79fba286a39c}{diverg}(uniths, bvars, us, vs, divus, divvs, divs)
760     \textcolor{keyword}{CALL }itps(ks, kb, div1, divs(1))
761     divbvar(mb,ks:kt)   = div1(ks:kt)/ad(mb)
762     b(mb)               = dot\_product(div1,unitv1)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g} + c(mb)
763     nterm               = int(budget(mb, 1), kind=\hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
764     budget(mb, nterm+2) = -dot\_product(div1,unitv1)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
765 \textcolor{keywordflow}{END DO}
766 
767 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_adc35216d512f6586071a79fba286a39c}{diverg}(unith, t, u, v, divu, divv, div1)
768 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_adc35216d512f6586071a79fba286a39c}{diverg}(uniths, ts, us, vs, divus, divvs, divs)
769 \textcolor{keyword}{CALL }itps(ks, kb, div1, divs(1))
770 divbvar(6,ks:kt)        = div1(ks:kt)
771 
772 \textcolor{keywordflow}{DO} mvar=1,nadvar
773     mm  = madn(mvar)
774     \textcolor{keywordflow}{DO} mb1=1,5
775         bvar1(kb:kt,:)  = -dbdvar(mb1,mvar,kb:kt,:)/2.0/wvar(mm,kb:kt,:)
776         \textcolor{keyword}{CALL }\hyperlink{namespacephysics_adc35216d512f6586071a79fba286a39c}{diverg}(unith, bvar1, u, v, divu, divv, div1)
777         a(mm,mb1)       = a(mm,mb1) + dot\_product(div1,unitv)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
778 \textcolor{keywordflow}{    END DO}
779 \textcolor{keywordflow}{END DO}
780 
781 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a56a179b5bd2c13a2201b2367037a42cf}{fcorlx}(unith, nstu, f, v, fcx1)
782 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a56a179b5bd2c13a2201b2367037a42cf}{fcorlx}(uniths, nsts, fs, vs, fcxs)
783 \textcolor{keyword}{CALL }itps(ks, kb, fcx1, fcxs(1))
784 budget(4,6)     = dot\_product(fcx1,unitv1)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
785 
786 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{fpgd}(unith, z, dzdx, fpx1)
787 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{fpgd}(uniths, zs, dzdxs, fpxs)
788 \textcolor{keyword}{CALL }itps(ks, kb, fpx1, fpxs(1))
789 budget(4,7)     = dot\_product(fpx1,unitv1)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
790 b(4)            = b(4) - budget(4,6) - budget(4,7)
791 
792 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a1f64bd544ea55c7fbbf5330725fc0896}{fcorly}(unith, nstu, f, u, fcy1)
793 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a1f64bd544ea55c7fbbf5330725fc0896}{fcorly}(uniths, nsts, fs, us, fcys)
794 \textcolor{keyword}{CALL }itps(ks, kb, fcy1, fcys(1))
795 budget(5,6)     = dot\_product(fcy1,unitv1)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
796 
797 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{fpgd}(unith, z, dzdy, fpy1)
798 \textcolor{keyword}{CALL }\hyperlink{namespacephysics_acf841366af6f4fd7502b4031a2cacb56}{fpgd}(uniths, zs, dzdys, fpys)
799 \textcolor{keyword}{CALL }itps(ks, kb, fpy1, fpys(1))
800 budget(5,7)     = dot\_product(fpy1,unitv1)*dp/\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}
801 b(5)            = b(5) - budget(5,6) - budget(5,7)
802 
803 fcx             = fcx1
804 fcy             = fcy1
805 fpx             = fpx1
806 fpy             = fpy1
807 
808 budget(1:5,2)   = -b(1:5)
809 b               = -b
810 
811 a1              = 0.0
812 b1              = 0.0
813 a1(1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad},1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad}) = a(1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad},1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad})
814 b1(1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad})       = b(1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad})
815 \textcolor{comment}{!A2              = A1}
816 
817 \textcolor{keywordflow}{IF} (\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad} .LT. 3 ) \textcolor{keywordflow}{THEN}
818     ld1(1)  = b1(1)/a1(1,1)
819 \textcolor{keywordflow}{ELSE}
820     \textcolor{keyword}{CALL }\hyperlink{namespacelu_a578a2275703e9c18d7f262f0a3482fbe}{ludcmp}(a=a1, n=\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad}, indx=indx, d=d, code=code)
821     \textcolor{keyword}{CALL }\hyperlink{namespacelu_a588ba20d76e8dd5c49b370d9ba3ec379}{lubksb}(a=a1, n=\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad}, indx=indx, b=b1)
822     ld1     = b1
823 \textcolor{keywordflow}{ENDIF}
824 
825 ld(1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad})   = ld1(1:\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad})
826 
827 \textcolor{comment}{!}
828 \textcolor{comment}{! I think this is where equation (24) in Zhang and Lin is implemented.}
829 \textcolor{comment}{!}
830 
831 \textcolor{keywordflow}{DO} mad=1,nadvar
832     mm = madn(mad)
833     \textcolor{keywordflow}{DO} mb=1,\hyperlink{namespacesettings_a4f624be133b88a44c8976b47b85e8eec}{nad}
834         \textcolor{keywordflow}{if} (mm .eq. 3) \textcolor{keywordflow}{then}
835 \textcolor{keywordflow}{        endif}
836         dus(mm,kb:kt,1:nstu)    = dus(mm,kb:kt,1:nstu) - ld(mb)*dbdvar(mb,mad,kb:kt,1:nstu)/2.0/wvar(mm,kb:
      kt,1:nstu)
837 \textcolor{keywordflow}{    END DO}
838 \textcolor{keywordflow}{END DO}
839 
840 \textcolor{comment}{!}
841 \textcolor{comment}{! Update T and Z based on s and r. This comment is copied directly from IDL code.}
842 \textcolor{comment}{!}
843 \textcolor{keywordflow}{DO} ist=1,nstu
844     sc(1:np)    = dus(3,1:np,ist)
845     rc(1:np)    = dus(2,1:np,ist)*\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}/\hyperlink{namespaceconstants_afb3befdfd57058ee9d073b832134a601}{lv0}
846     rc(1)       = dss(2,ist)*\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}/\hyperlink{namespaceconstants_afb3befdfd57058ee9d073b832134a601}{lv0}
847     sc(1)       = dss(3,ist)
848     \textcolor{keyword}{CALL }\hyperlink{namespacephysics_a3f1959e7b3ff1a8d052f1e0441b1c379}{s\_r\_to\_t\_z}(p, dss(8,ist), dss(7,ist), sc, rc, dus(6,1:np,ist), dus(7,1:np,ist))
849 \textcolor{keywordflow}{END DO}
850 
851 \textcolor{keywordflow}{DO} mm=1,\hyperlink{namespacesettings_a78876a80ce867f4bc71866b783b6de89}{nvbudget\_column}
852     dus(mm,1:np,1:nstu)     = dus(mm,1:np,1:nstu)/ad(mm)
853     nterm   = int(budget(mm,1), kind=\hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
854     budget(mm,2:nterm+2)    = budget(mm,2:nterm+2)/ad(mm)
855 \textcolor{keywordflow}{END DO}
856 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacenumerics_acc1dd6ef9a4cf200fd7701143c4ae29e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{namespacenumerics_acc1dd6ef9a4cf200fd7701143c4ae29e_icgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!calc\+\_\+budget\+\_\+layer@{calc\+\_\+budget\+\_\+layer}}
\index{calc\+\_\+budget\+\_\+layer@{calc\+\_\+budget\+\_\+layer}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{calc\+\_\+budget\+\_\+layer(\+N\+P, N\+T\+U, P, B\+U\+D\+G\+E\+T\+\_\+\+L\+A\+Y\+E\+R, B\+U\+D\+G\+E\+T\+\_\+\+C\+O\+L\+U\+M\+N\+S, A\+V\+E\+\_\+\+Q\+S, A\+V\+E\+\_\+\+S\+S)}{calc_budget_layer(NP, NTU, P, BUDGET_LAYER, BUDGET_COLUMNS, AVE_QS, AVE_SS)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::calc\+\_\+budget\+\_\+layer (
\begin{DoxyParamCaption}
\item[{integer (kind=ik4), intent(in)}]{NP, }
\item[{integer (kind=ik4), intent(in)}]{N\+TU, }
\item[{real (kind=rk8), dimension(np), intent(in)}]{P, }
\item[{real (kind=rk8), dimension(nvbudget\+\_\+layer,ntermmaxv,np,ntu), intent(inout)}]{B\+U\+D\+G\+E\+T\+\_\+\+L\+A\+Y\+ER, }
\item[{real (kind=rk8), dimension(nvbudget\+\_\+column,ntermmax,ntu), intent(in)}]{B\+U\+D\+G\+E\+T\+\_\+\+C\+O\+L\+U\+M\+NS, }
\item[{real (kind=rk8), dimension(ntu), intent(in)}]{A\+V\+E\+\_\+\+QS, }
\item[{real (kind=rk8), dimension(ntu), intent(in)}]{A\+V\+E\+\_\+\+SS}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_adbe2d748ef22c981cddde813d1db9d77}{}\label{namespacenumerics_adbe2d748ef22c981cddde813d1db9d77}


Definition at line 869 of file numerics.\+f90.


\begin{DoxyCode}
869 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
870 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
871 \textcolor{keywordtype}{USE }\hyperlink{namespacesettings}{settings}
872 
873 \textcolor{keywordtype}{IMPLICIT NONE}
874 
875 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                              :: np               \textcolor{comment}{! Number of
       pressure levels.}
876 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                                              :: ntu              \textcolor{comment}{! Number of
       times.}
877 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NP)}, \textcolor{keywordtype}{INTENT(IN)}                                  :: p                \textcolor{comment}{! Pressure
       of each level (hPa)}
878 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NTU)}, \textcolor{keywordtype}{INTENT(IN)}                                 :: ave\_qs
879 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NTU)}, \textcolor{keywordtype}{INTENT(IN)}                                 :: ave\_ss
880 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_COLUMN,NTERMMAX,NTU)}, \textcolor{keywordtype}{INTENT(IN)}        :: budget\_columns
881 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVBUDGET\_LAYER,NTERMMAXV,NP,NTU)}, \textcolor{keywordtype}{INTENT(INOUT)}  :: budget\_layer
882 
883 \textcolor{comment}{!}
884 \textcolor{comment}{! Local variables.}
885 \textcolor{comment}{!}
886 \textcolor{keywordtype}{REAL (KIND=RK8)}                                                     :: dp               \textcolor{comment}{! Vertical
       resolution (hPa)}
887 \textcolor{keywordtype}{REAL (KIND=RK8)}                                                     :: dp2
888 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(6,NP+1)}                                  :: omega\_vb
889 
890 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                                  :: ks               \textcolor{comment}{! Index of surface
       level.}
891 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                                  :: kt               \textcolor{comment}{! Index of top
       level.}
892 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                                  :: k1, k2
893 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                                  :: nterm
894 
895 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                                  :: kk,ll,mvb,iterm  \textcolor{comment}{! Counters.}
896 
897 \textcolor{comment}{!}
898 \textcolor{comment}{! Calculate vertical resolution.}
899 \textcolor{comment}{!}
900 dp  = p(1) - p(2)
901 
902 \textcolor{keywordflow}{DO} ll=2,ntu-1
903     ks  = int(budget\_layer(1,2,1,ll), kind=\hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
904     kt  = int(budget\_layer(1,4,1,ll), kind=\hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
905 
906     omega\_vb = 0.0
907     omega\_vb(1,ks)  = -budget\_columns(1,3,ll)*\hyperlink{namespaceconstants_a046aef138fbc8d05251d4fdc6eb3ee89}{g}/100.0                                   \textcolor{comment}{! hPa/s}
908 
909     \textcolor{keywordflow}{DO} kk=ks,kt
910         budget\_layer(1,4,kk,ll) = -budget\_layer(1,3,kk,ll)                              \textcolor{comment}{! -dw/dp}
911         dp2                     = dp
912         \textcolor{keywordflow}{IF} (kk .EQ. ks) dp2     = (budget\_columns(1,7,ll) - p(ks)) + 0.5*dp
913         \textcolor{keywordflow}{IF} (kk .EQ. kt) dp2     = 0.5*dp
914         omega\_vb(1,kk+1)        = omega\_vb(1,kk) + budget\_layer(1,4,kk,ll)*dp2          \textcolor{comment}{! DP2 vertically
       integrated not zero.}
915 \textcolor{keywordflow}{    END DO}
916 
917     \textcolor{keywordflow}{DO} mvb=2,6
918         \textcolor{keywordflow}{DO} kk=ks,kt+1
919             k1                  = max(ks, kk-1)
920             k2                  = min(kt,kk)
921             omega\_vb(mvb,kk)    = omega\_vb(1,kk) * (budget\_layer(mvb,1,k1,ll) + budget\_layer(mvb,1,k2,ll))*
      0.5
922 \textcolor{keywordflow}{        END DO}
923 \textcolor{keywordflow}{    END DO}
924 
925     kk                  = ks
926     mvb                 = 2
927     omega\_vb(mvb,kk)    = omega\_vb(1,kk)*ave\_qs(ll)
928     mvb                 = 3
929     omega\_vb(mvb,kk)    = omega\_vb(1,kk)*ave\_ss(ll)
930 
931     \textcolor{keywordflow}{DO} mvb=1,6
932         nterm                               = int(budget\_layer(mvb,1,1,1), kind=
      \hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
933         \textcolor{keywordflow}{DO} kk=ks,kt
934             budget\_layer(mvb,nterm+3,kk,ll) = 0.5*(omega\_vb(mvb,kk) + omega\_vb(mvb,kk+1))
935 \textcolor{keywordflow}{        END DO}
936         budget\_layer(mvb,nterm+3,kt,ll)     = omega\_vb(mvb,kt+1)
937 \textcolor{keywordflow}{    END DO}
938 
939     \textcolor{comment}{!}
940     \textcolor{comment}{! Vertical flux advection.}
941     \textcolor{comment}{!}
942     \textcolor{keywordflow}{DO} mvb=1,6
943         nterm                               = int(budget\_layer(mvb,1,1,1), kind=
      \hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
944         \textcolor{keywordflow}{DO} kk=ks,kt
945             budget\_layer(mvb,4,kk,ll)       = -(omega\_vb(mvb,kk) - omega\_vb(mvb,kk+1))/dp
946 \textcolor{keywordflow}{        END DO}
947         dp2                                 = 0.5*dp
948         budget\_layer(mvb,4,kt,ll)           = -(omega\_vb(mvb,kt) - omega\_vb(mvb,kt+1))/dp2
949         dp2                                 = 0.5*dp + (budget\_columns(1,7,ll) - p(ks))
950         budget\_layer(mvb,4,ks,ll)           = -(omega\_vb(mvb,ks) - omega\_vb(mvb,ks+1))/dp2
951 \textcolor{keywordflow}{    END DO}
952 
953     \textcolor{comment}{!}
954     \textcolor{comment}{! True advections.}
955     \textcolor{comment}{!}
956     \textcolor{keywordflow}{DO} mvb=2,6
957         budget\_layer(mvb,3,ks:kt,ll)    = budget\_layer(mvb,3,ks:kt,ll) - budget\_layer(mvb,1,ks:kt,ll)*
      budget\_layer(1,3,ks:kt,ll)
958         budget\_layer(mvb,4,ks:kt,ll)    = budget\_layer(mvb,4,ks:kt,ll) + budget\_layer(mvb,1,ks:kt,ll)*
      budget\_layer(1,3,ks:kt,ll)
959 \textcolor{keywordflow}{    END DO}
960 
961     \textcolor{keywordflow}{DO} mvb=1,5
962         nterm                               = int(budget\_layer(mvb,1,1,1), kind=
      \hyperlink{namespaceportable_aa110cf333432508140602ea192c4b2ea}{ik4})
963         \textcolor{keywordflow}{DO} kk=ks,kt
964             budget\_layer(mvb,nterm+2,kk,ll) = 0.0
965             \textcolor{keywordflow}{DO} iterm=2,nterm+1
966                 budget\_layer(mvb,nterm+2,kk,ll) = budget\_layer(mvb,nterm+2,kk,ll) - budget\_layer(mvb,iterm,
      kk,ll)
967 \textcolor{keywordflow}{            END DO}
968 \textcolor{keywordflow}{        END DO}
969 \textcolor{keywordflow}{    END DO}
970 
971     \textcolor{keywordflow}{DO} kk=ks,kt
972         budget\_layer(2,8,kk,ll) = budget\_layer(2,3,kk,ll) + budget\_layer(2,4,kk,ll)
973         budget\_layer(3,8,kk,ll) = budget\_layer(3,3,kk,ll) + budget\_layer(3,4,kk,ll)
974         budget\_layer(2,7,kk,ll) = budget\_layer(3,5,kk,ll) + budget\_layer(2,5,kk,ll) - budget\_layer(3,7,kk,
      ll)
975 \textcolor{keywordflow}{    END DO}
976 \textcolor{keywordflow}{END DO}
977 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=333pt]{namespacenumerics_adbe2d748ef22c981cddde813d1db9d77_icgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!caldev@{caldev}}
\index{caldev@{caldev}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{caldev(\+D\+U, K\+T, K\+S, N\+S\+T\+U, N\+T\+U, N\+P, N\+V\+U, D\+E\+V\+M2)}{caldev(DU, KT, KS, NSTU, NTU, NP, NVU, DEVM2)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::caldev (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(nvu,np,nstu,ntu), intent(in)}]{DU, }
\item[{integer (kind=ik4), intent(in)}]{KT, }
\item[{integer (kind=ik4), intent(in)}]{KS, }
\item[{integer (kind=ik4), intent(in)}]{N\+S\+TU, }
\item[{integer (kind=ik4), intent(in)}]{N\+TU, }
\item[{integer (kind=ik4), intent(in)}]{NP, }
\item[{integer (kind=ik4), intent(in)}]{N\+VU, }
\item[{real (kind=rk8), dimension(nvu,np)}]{D\+E\+V\+M2}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_add44a47f4f996c0266711b825fd6bb20}{}\label{namespacenumerics_add44a47f4f996c0266711b825fd6bb20}


Definition at line 172 of file numerics.\+f90.


\begin{DoxyCode}
172 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
173 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
174 
175 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                          :: kt       \textcolor{comment}{! Top level for the variational
       analysis.}
176 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                          :: ks       \textcolor{comment}{! Surface level for the variational
       analysis.}
177 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                          :: nstu     \textcolor{comment}{! Number of stations.}
178 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                          :: ntu      \textcolor{comment}{! Number of times.}
179 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                          :: np       \textcolor{comment}{! Number of pressure levels.}
180 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                          :: \hyperlink{namespacesettings_a79e2ff19d589b215ed9176906dd5cbbf}{nvu}      \textcolor{comment}{! Number of variables.}
181 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVU,NP,NSTU,NTU)}, \textcolor{keywordtype}{INTENT(IN)} :: du       \textcolor{comment}{! Holds the data (see assim.f90 for a
       description of the array)}
182 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVU,NP)}                      :: devm2    \textcolor{comment}{! Holds the RMSE and other stuff.}
183 
184 \textcolor{comment}{!}
185 \textcolor{comment}{! Local variables.}
186 \textcolor{comment}{!}
187 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVU,NP)}                      :: devm     \textcolor{comment}{! Holds the time mnd station ean of the
       variables.}
188 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NVU,NP,NSTU,NTU)}             :: dev      \textcolor{comment}{! The difference between the variables
       and the mean (DEVM)}
189 
190 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                      :: ii, ist  \textcolor{comment}{!  Counters}
191 
192 \textcolor{comment}{!}
193 \textcolor{comment}{! Here we calculate the mean of the five variables accross the stations at each level. When calculating the
       mean, neglect the}
194 \textcolor{comment}{! start and end times.}
195 \textcolor{comment}{!}
196 devm(2:6,ks:kt) = sum(sum(du(2:6,ks:kt,:,2:ntu-1),dim=4),dim=3)/nstu/(ntu-2)
197 
198 \textcolor{comment}{!}
199 \textcolor{comment}{! Now calculate the difference from the mean. This is easiest to do in a traditional loop.}
200 \textcolor{comment}{!}
201 dev                 = 0.0
202 \textcolor{keywordflow}{DO} ii=2,ntu-1
203     \textcolor{keywordflow}{DO} ist=1,nstu
204         dev(:,:,ist,ii) = du(:,:,ist,ii) - devm(:,:)
205 \textcolor{keywordflow}{    END DO}
206 \textcolor{keywordflow}{END DO}
207 
208 \textcolor{comment}{!}
209 \textcolor{comment}{! Finally, calculate the RMSE.}
210 devm2               = devm
211 devm2(2:6,ks:kt)    = sqrt(sum(sum(dev(2:6,ks:kt,:,2:ntu-1)**2,dim=4),dim=3)/nstu/(ntu-2))
212 
213 devm2(2,:)          = devm2(2,:)/\hyperlink{namespaceconstants_afb3befdfd57058ee9d073b832134a601}{lv0}*\hyperlink{namespaceconstants_a32354adf3493f59d0fc17b0302b2c368}{cpd}    \textcolor{comment}{! The other stuff mentioned above.}
214 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=309pt]{namespacenumerics_add44a47f4f996c0266711b825fd6bb20_icgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!gmean@{gmean}}
\index{gmean@{gmean}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{gmean(\+M\+G, D\+P, N\+V, N\+S\+T, N\+T, T\+S\+M\+O\+O\+T\+H)}{gmean(MG, DP, NV, NST, NT, TSMOOTH)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::gmean (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(nt), intent(out)}]{MG, }
\item[{real (kind=rk8), dimension(nv,nst,nt), intent(in)}]{DP, }
\item[{integer (kind=ik4), intent(in)}]{NV, }
\item[{integer (kind=ik4), intent(in)}]{N\+ST, }
\item[{integer (kind=ik4), intent(in)}]{NT, }
\item[{integer (kind=ik4), intent(in)}]{T\+S\+M\+O\+O\+TH}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_afbd04035bb50e63d44980bf39cf84ac3}{}\label{namespacenumerics_afbd04035bb50e63d44980bf39cf84ac3}


Definition at line 61 of file numerics.\+f90.


\begin{DoxyCode}
61 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
62 
63 \textcolor{keywordtype}{IMPLICIT NONE}
64 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                      :: nt           \textcolor{comment}{! Number of time steps.}
65 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                      :: tsmooth      \textcolor{comment}{! 0 = no smoothing.}
66 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                      :: nv           \textcolor{comment}{! Number of variables (only the last
       variable is averaged).}
67 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                      :: nst          \textcolor{comment}{! Number of stations in the analysis
       grid.}
68 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NT)}, \textcolor{keywordtype}{INTENT(OUT)}         :: mg           \textcolor{comment}{! The spatial average of DP is stored
       in this array.}
69 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NV,NST,NT)}, \textcolor{keywordtype}{INTENT(IN)}   :: dp           \textcolor{comment}{! Data to be averaged, and possibly
       time smoothed.}
70 
71 mg  = sum(dp(nv,:,:), dim=1)/nst        \textcolor{comment}{! Average the last variable along the station dimension (DIM=1,
       because the rank of the}
72                                         \textcolor{comment}{! array subsection is only two (the variable dimension "collapses"
       when the subsection}
73                                         \textcolor{comment}{! is extracted)).}
74 \textcolor{keywordflow}{IF} (tsmooth .GT. 0) \textcolor{keywordflow}{THEN}
75     \textcolor{keyword}{CALL }smooth(mg, \textcolor{keyword}{SIZE}(mg), tsmooth, .false.)
76 \textcolor{keywordflow}{END IF}
77 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=303pt]{namespacenumerics_afbd04035bb50e63d44980bf39cf84ac3_cgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!horizontal\+\_\+field@{horizontal\+\_\+field}}
\index{horizontal\+\_\+field@{horizontal\+\_\+field}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{horizontal\+\_\+field(\+N\+S\+T, L\+O\+N, L\+A\+T, X, Y, F, D\+Z\+D\+X, D\+Z\+D\+Y, D\+I\+V\+U, D\+I\+V\+V)}{horizontal_field(NST, LON, LAT, X, Y, F, DZDX, DZDY, DIVU, DIVV)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::horizontal\+\_\+field (
\begin{DoxyParamCaption}
\item[{integer (kind=ik4), intent(in)}]{N\+ST, }
\item[{real (kind=rk8), dimension(nst), intent(in)}]{L\+ON, }
\item[{real (kind=rk8), dimension(nst), intent(in)}]{L\+AT, }
\item[{real (kind=rk8), dimension(nst), intent(out)}]{X, }
\item[{real (kind=rk8), dimension(nst), intent(out)}]{Y, }
\item[{real (kind=rk8), dimension(nst), intent(out)}]{F, }
\item[{real (kind=rk8), dimension(nst), intent(out)}]{D\+Z\+DX, }
\item[{real (kind=rk8), dimension(nst), intent(out)}]{D\+Z\+DY, }
\item[{real (kind=rk8), dimension(nst), intent(out)}]{D\+I\+VU, }
\item[{real (kind=rk8), dimension(nst), intent(out)}]{D\+I\+VV}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_a9581a41d0b81a5ded9690972e499c629}{}\label{namespacenumerics_a9581a41d0b81a5ded9690972e499c629}


Definition at line 231 of file numerics.\+f90.


\begin{DoxyCode}
231 \textcolor{keywordtype}{USE }\hyperlink{namespaceconstants}{constants}
232 
233 \textcolor{keywordtype}{IMPLICIT NONE}
234 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                :: nst          \textcolor{comment}{! The number of stations in the array.}
235 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(IN)}   :: lon          \textcolor{comment}{! The longitudes of each station.}
236 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(IN)}   :: lat          \textcolor{comment}{! The latitudes of each station.}
237 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(OUT)}  :: x            \textcolor{comment}{! The cartesian x-coordinates of each
       station.}
238 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(OUT)}  :: y            \textcolor{comment}{! The cartesian y-coordinates of each
       station.}
239 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(OUT)}  :: f            \textcolor{comment}{! Coriolis parameter at each station.}
240 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(OUT)}  :: dzdx         \textcolor{comment}{!}
241 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(OUT)}  :: dzdy         \textcolor{comment}{!}
242 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(OUT)}  :: divu         \textcolor{comment}{!}
243 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}, \textcolor{keywordtype}{INTENT(OUT)}  :: divv         \textcolor{comment}{!}
244 
245 \textcolor{comment}{!}
246 \textcolor{comment}{! Local variables.}
247 \textcolor{comment}{!}
248 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST)}               :: z1
249 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(NST+2)}             :: x1, y1               \textcolor{comment}{! Holds coordinates of next station
       in the "loop".}
250 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                            :: ii                   \textcolor{comment}{! Counter.}
251 \textcolor{keywordtype}{REAL (KIND=RK8)}                               :: ax, ay, bx, by, c3   \textcolor{comment}{! Temporary variables.}
252 \textcolor{keywordtype}{REAL (KIND=RK8)}                               :: area                 \textcolor{comment}{! Area of sounding array.}
253 
254 \textcolor{comment}{!}
255 \textcolor{comment}{! Calculate the cartesian co-ordinates of each station, and the coriolis parameter at each station.}
256 \textcolor{comment}{!}
257 
258 x   = 2.0*sin((lon-lon(1))/360.0*2*\hyperlink{namespaceconstants_a064bd715409f723a4e6d45b6300c5ca0}{pi}/2.0)*\hyperlink{namespaceconstants_afaa5eaa2c9ee648a808fb8e1c94e76f8}{rearth}*cos(lat/180.0*\hyperlink{namespaceconstants_a064bd715409f723a4e6d45b6300c5ca0}{pi})
259 y   = 2.0*sin((lat-lat(1))/360.0*2*\hyperlink{namespaceconstants_a064bd715409f723a4e6d45b6300c5ca0}{pi}/2.0)*\hyperlink{namespaceconstants_afaa5eaa2c9ee648a808fb8e1c94e76f8}{rearth}
260 f   = 2.0*\hyperlink{namespaceconstants_a67051296d7b4bcd0d4cee08bba6e46fa}{omega}*sin(lat/180.0*\hyperlink{namespaceconstants_a064bd715409f723a4e6d45b6300c5ca0}{pi})
261 
262 \textcolor{comment}{!}
263 \textcolor{comment}{! Calculate the gradient terms. We do this by fitting a plane of best fit to the points.}
264 \textcolor{comment}{!}
265 z1  = 0
266 \textcolor{keywordflow}{DO} ii=1,nst
267     z1(ii)   = 1.0
268     \textcolor{keyword}{CALL }line\_fit\_xyz(nst, x, y, z1, dzdx(ii), dzdy(ii), c3)
269     z1(ii)   = 0.0
270 \textcolor{keywordflow}{END DO}
271 
272 \textcolor{comment}{!}
273 \textcolor{comment}{! Set X1 and Y1 to contain the coordinates of the next station in the "loop"}
274 \textcolor{comment}{!}
275 \textcolor{keywordflow}{DO} ii=1,nst
276     x1(ii+1)    = x(ii)
277     y1(ii+1)    = y(ii)
278 \textcolor{keywordflow}{END DO}
279 x1(1)       = x1(nst+1)
280 y1(1)       = y1(nst+1)
281 x1(nst+2)   = x1(2)
282 y1(nst+2)   = y1(2)
283 
284 \textcolor{comment}{!}
285 \textcolor{comment}{! Calculate the area of the sounding array.}
286 \textcolor{comment}{!}
287 area        = 0.0
288 \textcolor{keywordflow}{DO} ii=2,nst-1
289     ax      = x(1) - x(ii)
290     ay      = y(1) - y(ii)
291     bx      = x(1) - x(ii+1)
292     by      = y(1) - y(ii+1)
293     area    = area + abs(ax*by - ay*bx)/2.0
294 \textcolor{keywordflow}{END DO}
295 
296 \textcolor{comment}{!}
297 \textcolor{comment}{! Now calculate the divergence terms using the line integral method (see Davies-Jones (1993) equations
       8-10)}
298 \textcolor{comment}{!}
299 \textcolor{keywordflow}{DO} ii=1,nst
300     divu(ii)    = (y1(ii+2) - y1(ii))/2.0/area
301     divv(ii)    = -(x1(ii+2) - x1(ii))/2.0/area
302 \textcolor{keywordflow}{END DO}
303 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacenumerics_a9581a41d0b81a5ded9690972e499c629_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacenumerics_a9581a41d0b81a5ded9690972e499c629_icgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!itps@{itps}}
\index{itps@{itps}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{itps(\+K\+S, K\+B, D, D\+S)}{itps(KS, KB, D, DS)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::itps (
\begin{DoxyParamCaption}
\item[{integer (kind=ik4), intent(in)}]{KS, }
\item[{integer (kind=ik4), intent(in)}]{KB, }
\item[{real (kind=rk8), dimension(\+:), intent(inout)}]{D, }
\item[{real (kind=rk8), intent(in)}]{DS}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_ac972e0e69239cba641ad373fee101472}{}\label{namespacenumerics_ac972e0e69239cba641ad373fee101472}


Definition at line 23 of file numerics.\+f90.


\begin{DoxyCode}
23 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
24 
25 \textcolor{keywordtype}{IMPLICIT NONE}
26 
27 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}              :: ks   \textcolor{comment}{! Level where the surface pressure is.}
28 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}              :: kb   \textcolor{comment}{! Level where the actual surface is.}
29 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)},\textcolor{keywordtype}{INTENT(INOUT)} :: d    \textcolor{comment}{! Array to hold interpolated data.}
30 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                 :: ds   \textcolor{comment}{! Value of D at the level where the surface pressure
       is.}
31 
32 \textcolor{comment}{!}
33 \textcolor{comment}{! Local variables.}
34 \textcolor{comment}{!}
35 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                          :: kk   \textcolor{comment}{! Counter.}
36 
37 \textcolor{keywordflow}{IF} (ks .LT. kb) \textcolor{keywordflow}{THEN}
38     \textcolor{comment}{!}
39     \textcolor{comment}{! If we enter this loop, the surface pressure level is lower than the level where the surface is. No
       other case}
40     \textcolor{comment}{! (apart from the ideal one, where the surface pressure and surface levels are the same) is considered.}
41     \textcolor{comment}{!}
42     d(ks)       = ds
43     \textcolor{keywordflow}{DO} kk=ks+1,kb-1
44         d(kk)   = ds + (d(kb) - ds)/(kb - ks)*(kk - ks)
45 \textcolor{keywordflow}{    END DO}
46 \textcolor{keywordflow}{END IF}
47 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacenumerics_ac972e0e69239cba641ad373fee101472_icgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!line\+\_\+fit\+\_\+xyz@{line\+\_\+fit\+\_\+xyz}}
\index{line\+\_\+fit\+\_\+xyz@{line\+\_\+fit\+\_\+xyz}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{line\+\_\+fit\+\_\+xyz(\+N, X, Y, Z, D\+Z\+D\+X, D\+Z\+D\+Y, Z0)}{line_fit_xyz(N, X, Y, Z, DZDX, DZDY, Z0)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::line\+\_\+fit\+\_\+xyz (
\begin{DoxyParamCaption}
\item[{integer (kind=ik4), intent(in)}]{N, }
\item[{real (kind=rk8), dimension(n), intent(in)}]{X, }
\item[{real (kind=rk8), dimension(n), intent(in)}]{Y, }
\item[{real (kind=rk8), dimension(n), intent(in)}]{Z, }
\item[{real (kind=rk8), intent(out)}]{D\+Z\+DX, }
\item[{real (kind=rk8), intent(out)}]{D\+Z\+DY, }
\item[{real (kind=rk8), intent(out)}]{Z0}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_a8e58d8bf1c738af1a91517fdb8b81aa2}{}\label{namespacenumerics_a8e58d8bf1c738af1a91517fdb8b81aa2}


Definition at line 318 of file numerics.\+f90.


\begin{DoxyCode}
318 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
319 \textcolor{keywordtype}{USE }\hyperlink{namespacelu}{lu}
320 
321 \textcolor{keywordtype}{IMPLICIT NONE}
322 
323 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}              :: n            \textcolor{comment}{! The number of points}
324 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(IN)}   :: x            \textcolor{comment}{! The cartesian x-coordinates of each point}
325 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(IN)}   :: y            \textcolor{comment}{! The cartesian y-coordinates of each point}
326 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(IN)}   :: z            \textcolor{comment}{! The z-value at each point}
327 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(OUT)}                :: dzdx         \textcolor{comment}{! Slope of the plane in the x-direction}
328 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(OUT)}                :: dzdy         \textcolor{comment}{! Slope of the plane in the y-direction}
329 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(OUT)}                :: z0           \textcolor{comment}{! z-value at (x,y) = (0,0)}
330 
331 \textcolor{comment}{!}
332 \textcolor{comment}{! Local variables.}
333 \textcolor{comment}{!}
334 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(3,3)}             :: a 
335 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(3)}               :: b
336 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{DIMENSION(3)}            :: indx
337 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                          :: code, d
338 
339 \textcolor{comment}{!}
340 \textcolor{comment}{! By solving the equation    | sum(x^2)  sum(xy)     sum(x)  |     | sum(xz) |}
341 \textcolor{comment}{!                            | sum(xy)   sum(y^2)    sum(y)  | X = | sum(yz) |}
342 \textcolor{comment}{!                            | sum(x)    sum(y)      N       |     | sum(z)  |}
343 \textcolor{comment}{!}
344 \textcolor{comment}{! for X, we can find the slopes DZDX, DZDY aand the intercept Z0 (all defined above) for the plane of best
       fit:}
345 \textcolor{comment}{!}
346 \textcolor{comment}{!     | DZDX |}
347 \textcolor{comment}{! X = | DZDY |}
348 \textcolor{comment}{!     |  Z0  |}
349 \textcolor{comment}{!}
350 \textcolor{comment}{! Whoever worked this out was pretty clever.}
351 \textcolor{comment}{!}
352 
353 a = reshape(source=(/   sum(x*x), sum(x*y), sum(x), &
354 &                       sum(x*y), sum(y*y), sum(y), &
355 &                       sum(x),   sum(y),   \textcolor{keywordtype}{REAL(N, RK8)} /), shape=(/ 3, 3 /))
356 
357 b = (/ sum(x*z), sum(y*z), sum(z) /)
358 
359 \textcolor{comment}{!}
360 \textcolor{comment}{! These calls solve the matrix equation AX=B. First, we calculate the LU decomposition of A using the
       LUDCMP}
361 \textcolor{comment}{! subroutine, then we solve for X using the LUBKSB subroutine. Details on the maths behind all this can be
       found}
362 \textcolor{comment}{! from many sources.}
363 \textcolor{comment}{!}
364 \textcolor{keyword}{CALL }\hyperlink{namespacelu_a578a2275703e9c18d7f262f0a3482fbe}{ludcmp}(a, 3, indx, d, code)
365 \textcolor{keywordflow}{IF} (code .EQ. 1) \textcolor{keywordflow}{THEN}
366     print *,\textcolor{stringliteral}{'W: Tried to do a LU decomposition on a singular matrix.'}
367     print *,\textcolor{stringliteral}{'   This code is not clever enough to handle this case.'}
368     stop \textcolor{stringliteral}{'1'}
369 \textcolor{keywordflow}{END IF}
370 \textcolor{keyword}{CALL }\hyperlink{namespacelu_a588ba20d76e8dd5c49b370d9ba3ec379}{lubksb}(a, 3, indx, b)
371 
372 dzdx = b(1)
373 dzdy = b(2)
374 z0   = b(3)
375 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=290pt]{namespacenumerics_a8e58d8bf1c738af1a91517fdb8b81aa2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacenumerics_a8e58d8bf1c738af1a91517fdb8b81aa2_icgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!smooth@{smooth}}
\index{smooth@{smooth}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{smooth(\+A\+R\+R\+A\+Y, N, F\+I\+L\+T\+E\+R\+\_\+\+W\+I\+D\+T\+H, C\+Y\+C\+L\+I\+C)}{smooth(ARRAY, N, FILTER_WIDTH, CYCLIC)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::smooth (
\begin{DoxyParamCaption}
\item[{real (kind=rk8), dimension(n), intent(inout)}]{A\+R\+R\+AY, }
\item[{integer (kind=ik4), intent(in)}]{N, }
\item[{integer (kind=ik4), intent(in)}]{F\+I\+L\+T\+E\+R\+\_\+\+W\+I\+D\+TH, }
\item[{logical, intent(in)}]{C\+Y\+C\+L\+IC}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_a354d8c793bd1515de7af7cfa32c51389}{}\label{namespacenumerics_a354d8c793bd1515de7af7cfa32c51389}


Definition at line 90 of file numerics.\+f90.


\begin{DoxyCode}
90 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
91 
92 \textcolor{keywordtype}{IMPLICIT NONE}
93 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                      :: n            \textcolor{comment}{! Number of elements in ARRAY.}
94 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                      :: filter\_width \textcolor{comment}{! Width of the box car filter.}
95 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(INOUT)}        :: array        \textcolor{comment}{! The array of data being filtered.}
96 \textcolor{keywordtype}{LOGICAL}, \textcolor{keywordtype}{INTENT(IN)}                                 :: cyclic       \textcolor{comment}{! Set to .TRUE. if data are cyclic.}
97 
98 \textcolor{comment}{!}
99 \textcolor{comment}{! Local variables.}
100 \textcolor{comment}{!}
101 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{ALLOCATABLE}          :: tmparray1,tmparray2     \textcolor{comment}{! Temporary array used for
       filtering.}
102 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                  :: tmpwidth     \textcolor{comment}{! Filter width.}
103 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                  :: memst        \textcolor{comment}{! Status code from memory allocation
       functions.}
104 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                                  :: ii           \textcolor{comment}{! Counter.}
105 
106 \textcolor{comment}{!}
107 \textcolor{comment}{! First check that (i) the filter width is not too large, and (ii) the filter width is an odd number. If
       the filter width is an even}
108 \textcolor{comment}{! number, we set a temporary filter width which is one greater than the value passed to the subroutine.}
109 \textcolor{comment}{!}
110 \textcolor{keywordflow}{IF} (mod(filter\_width, 2) .EQ. 0) \textcolor{keywordflow}{THEN}
111     tmpwidth    = filter\_width + 1
112 \textcolor{keywordflow}{ELSE}
113     tmpwidth    = filter\_width
114 \textcolor{keywordflow}{END IF}
115 
116 \textcolor{keywordflow}{IF} (tmpwidth .GT. n) \textcolor{keywordflow}{THEN}
117     print *,\textcolor{stringliteral}{'W: Setting filter width to be the same as the number of points in array, '},n
118     tmpwidth    = n
119 \textcolor{keywordflow}{END IF}
120 
121 
122 \textcolor{comment}{!}
123 \textcolor{comment}{! Allocate a temporary array to be used with filtering. If the data are cyclic, then this array is slightly
       larger, to allow}
124 \textcolor{comment}{! us to nicely handle data at the beginning and ends of the array.}
125 \textcolor{comment}{!}
126 \textcolor{keywordflow}{IF} (cyclic) \textcolor{keywordflow}{THEN}
127     \textcolor{keyword}{ALLOCATE}(tmparray1(n+tmpwidth-1), tmparray2(n+tmpwidth-1), stat=memst)
128     \textcolor{keywordflow}{IF} (memst .NE. 0) \textcolor{keywordflow}{THEN}
129         print *,\textcolor{stringliteral}{'Not able to allocate memory for the temporary filtering array'}
130         stop \textcolor{stringliteral}{'1'}
131 \textcolor{keywordflow}{    END IF}
132     tmparray1(1:tmpwidth/2)                  = array(n-tmpwidth/2+1:n)   \textcolor{comment}{! I think this still works when
       TMPWIDTH/2 = 0}
133     tmparray1(tmpwidth/2+1:tmpwidth/2+n)     = array(1:n)
134     tmparray1(tmpwidth/2+n+1:tmpwidth+n-1)   = array(1:tmpwidth/2)
135 \textcolor{keywordflow}{ELSE}
136     \textcolor{keyword}{ALLOCATE}(tmparray1(n), tmparray2(n), stat=memst)
137     \textcolor{keywordflow}{IF} (memst .NE. 0) \textcolor{keywordflow}{THEN}
138         print *,\textcolor{stringliteral}{'Not able to allocate memory for the temporary filtering array'}
139         stop \textcolor{stringliteral}{'1'}
140 \textcolor{keywordflow}{    END IF}
141     tmparray1    = array
142 \textcolor{keywordflow}{END IF}
143 
144 \textcolor{comment}{!}
145 \textcolor{comment}{! Now do the box car filtering.}
146 \textcolor{comment}{!}
147 \textcolor{keywordflow}{DO} ii=1,\textcolor{keyword}{SIZE}(tmparray2)
148         tmparray2(ii)   = sum(tmparray1(max(1, ii-tmpwidth/2):min(ii+tmpwidth/2, \textcolor{keyword}{SIZE}(tmparray2))))/
      tmpwidth
149 \textcolor{keywordflow}{END DO}
150 
151 array(1:n)  = tmparray2(tmpwidth/2+1:tmpwidth/2+n)
152 
153 \textcolor{comment}{!}
154 \textcolor{comment}{! Deallocate allocated memory.}
155 \textcolor{comment}{!}
156 \textcolor{keywordflow}{IF} (\textcolor{keyword}{ALLOCATED}(tmparray1))    \textcolor{keyword}{DEALLOCATE}(tmparray1)
157 \textcolor{keywordflow}{IF} (\textcolor{keyword}{ALLOCATED}(tmparray2))    \textcolor{keyword}{DEALLOCATE}(tmparray2)
158 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=303pt]{namespacenumerics_a354d8c793bd1515de7af7cfa32c51389_icgraph}
\end{center}
\end{figure}


\index{numerics@{numerics}!windown@{windown}}
\index{windown@{windown}!numerics@{numerics}}
\subsubsection[{\texorpdfstring{windown(\+N, X, D\+X, X1, L0, L1)}{windown(N, X, DX, X1, L0, L1)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine numerics\+::windown (
\begin{DoxyParamCaption}
\item[{integer (kind=ik4), intent(in)}]{N, }
\item[{real (kind=rk8), dimension(n), intent(in)}]{X, }
\item[{real(kind=rk8), intent(in)}]{DX, }
\item[{real (kind=rk8), intent(in)}]{X1, }
\item[{integer (kind=ik4), intent(in)}]{L0, }
\item[{integer (kind=ik4), intent(out)}]{L1}
\end{DoxyParamCaption}
)}\hypertarget{namespacenumerics_aa16b459eac85058fd1da1b9ebc4555b9}{}\label{namespacenumerics_aa16b459eac85058fd1da1b9ebc4555b9}


Definition at line 389 of file numerics.\+f90.


\begin{DoxyCode}
389 \textcolor{keywordtype}{USE }\hyperlink{namespaceportable}{portable}
390 
391 \textcolor{keywordtype}{IMPLICIT NONE}
392 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                  :: n        \textcolor{comment}{! Number of vertical layers.}
393 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{DIMENSION(N)}, \textcolor{keywordtype}{INTENT(IN)}       :: x        \textcolor{comment}{! Array containing the levels of each layer.}
394 \textcolor{keywordtype}{REAL(KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                      :: dx       \textcolor{comment}{! Layer depth (assume layers are equal depth).}
395 \textcolor{keywordtype}{REAL (KIND=RK8)}, \textcolor{keywordtype}{INTENT(IN)}                     :: x1       \textcolor{comment}{! We are searching for the layer which includes
       this level.}
396 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(IN)}                  :: l0       \textcolor{comment}{! The bottom layer to start searching at.}
397 \textcolor{keywordtype}{INTEGER (KIND=IK4)}, \textcolor{keywordtype}{INTENT(OUT)}                 :: l1       \textcolor{comment}{! The index of the layer which contains the X1
       level.}
398 
399 \textcolor{comment}{!}
400 \textcolor{comment}{! Local variables.}
401 \textcolor{comment}{!}
402 \textcolor{keywordtype}{REAL (KIND=RK8)}                                 :: xa, xb   \textcolor{comment}{! Top and bottom of the vertical layer.}
403 \textcolor{keywordtype}{INTEGER (KIND=IK4)}                              :: ll       \textcolor{comment}{! Layer number.}
404 
405 l1      = -1
406 ll      = l0
407 \textcolor{keywordflow}{DO} \textcolor{keywordflow}{WHILE} ((ll .LE. n) .AND. (l1 .EQ. -1))
408     xa  = x(ll) - dx*(0.5+0.1)
409     xb  = x(ll) + dx*(0.5-0.1)
410     \textcolor{keywordflow}{IF} ((x1 .GE. xa) .AND. (x1 .LT. xb)) l1 = ll
411     ll  = ll + 1
412 \textcolor{keywordflow}{END DO}
413 
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=263pt]{namespacenumerics_aa16b459eac85058fd1da1b9ebc4555b9_icgraph}
\end{center}
\end{figure}


